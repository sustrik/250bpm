<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Select Statement Considered Harmful - 250bpm</title>
    
    	<script type="text/javascript" src="http://www.wikidot.com/default__flow/login__CustomDomainScript?site_id=148706"></script>

    
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = 'http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "250bpm.com";
        WIKIREQUEST.info.siteId = 148706;
        WIKIREQUEST.info.siteUnixName = "250bpm";
        WIKIREQUEST.info.categoryId = 2550760;
        WIKIREQUEST.info.themeId = 18520;
        WIKIREQUEST.info.requestPageName = "blog:72";
        OZONE.request.timestamp = 1594263557;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "blog:72";
        WIKIREQUEST.info.pageId = 36613769;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/WIKIDOT.combined.js"></script>
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
        
                
        /* theme */
                    @import url(http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--theme/base/css/style.css);
                    @import url(http://250bpm.wdfiles.com/local--theme/250bpm/style.css);
            </style>
    
        
        
        
    <link rel="shortcut icon" href="/local--favicon/favicon.gif"/>
    <link rel="icon" type="image/gif" href="/local--favicon/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="/common--images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/common--images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/common--images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-3207370-9']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
        <link rel="manifest" href="/onesignal/manifest.json" />
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" acync=""></script>
    <script>
        var OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
          OneSignal.init({
            appId: null,
          });
        });
    </script>
        
<link rel="alternate" type="application/rss+xml" title="Comments for the page &quot;Select Statement Considered Harmful&quot;" href="/feed/page/comments-36613769.xml"/><script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumCommentsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadPostsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/sub/ForumNewPostFormModule.js"></script>
</head>
<body id="html-body">
<div id="skrollr-body">
<a name="page-top"></a>





<div id="container-wrap-wrap">
    <div id="container-wrap">
        <div id="container">
            <div id="header">
              <h1><a href="/"><span>250bpm</span></a></h1>
                
                
                <!-- google_ad_section_start(weight=ignore) -->
                
                <div id="search-top-box" class="form-search">
    <form id="search-top-box-form" action="dummy" class="input-append">
        <input id="search-top-box-input" class="text empty search-query" type="text" size="15" name="query" value="Search this site" onfocus="if(YAHOO.util.Dom.hasClass(this, 'empty')){YAHOO.util.Dom.removeClass(this,'empty'); this.value='';}"/><input class="button btn" type="submit" name="search" value="Search"/>
    </form>
</div>
                
                
                    <div id="top-bar">
                        

<ul>
<li><a href="/">Home</a></li>
<li><a href="https://github.com/sustrik/cartesian">Cartesian</a></li>
<li><a href="http://libdill.org">Libdill</a></li>
<li><a href="http://nanomsg.org">Nanomsg</a></li>
<li><a href="https://github.com/sustrik/tiles">Tiles</a></li>
<li><a href="http://zero.mq">ZeroMQ</a></li>
<li><a href="/contact">Contact</a></li>
</ul>

                    </div>
                
                <div id="login-status"><a href="javascript:;" onclick="WIKIDOT.page.listeners.createAccount(event)" class="login-status-create-account btn">Create account</a> <span>or</span> <a href="javascript:;" onclick="WIKIDOT.page.listeners.loginClick(event)" class="login-status-sign-in btn btn-primary">Sign in</a> </div>
                <div id="header-extra-div-1"><span></span></div><div id="header-extra-div-2"><span></span></div><div id="header-extra-div-3"><span></span></div>
            </div>
            
            <div id="content-wrap">
                
                    <div id="side-bar">
                        


                        


                        


                    </div>
                
                
                <!-- google_ad_section_end -->
                
                <div id="main-content">
                    <div id="action-area-top"></div>
                    
                    
                        <div id="page-title">
                            Select Statement Considered Harmful
                        </div>
                    

                    

                    



                    <div id="page-content">
                        

<div style="width:50em"><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:71">Structured Concurrency</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:73">Footnotes to &quot;Select Statement Considered Harmful&quot;</a></p>
</div>
    
    
    
    </div>
<h2 id="toc0"><span>Abstract</span></h2>
<p>This article is a follow-up to Edgar Dijkstra's classic <a href="http://homepages.cwi.nl/~storm/teaching/reader/Dijkstra68.pdf">&quot;Go To Statement Considered Harmful&quot;</a> article. It takes Dijkstra's premise and applies it to concurrent programming.</p>
<h2 id="toc1"><span>Program and Process</span></h2>
<p>Dijkstra says:</p>
<blockquote>
<p>My second remark is that our intellectual powers are rather geared to master static relations and that our powers to visualize processes evolving it time are relatively poorly developed. For that reason we should do (as wise programmers aware of our limitations) our utmost to shorten the conceptual gap between the static program and the dynamic process, to make the correspondence between the program (spread out in text space) and the process (spread out in time) as trivial as possible.</p>
</blockquote>
<p>My observation is that in the code using select, whether POSIX select() function, Go select{} statement or an equivalent in other languages, the correspondence between code layout and its execution is severely harmed.</p>
<p>Consider the following example (in Go):</p>
<div class="code">
<pre>
<code>for {
  select {
  case &lt;- channelA:
      doA()
  case &lt;- channelB:
      doB()
  case &lt;- channelC:
      doC()
  }
}</code>
</pre></div>
<p>The order of execution of individual clauses has no relationship whatsoever to their ordering in the code.</p>
<p>On the other hand, in the following snippet the ordering corresponds 1:1 to the execution order:</p>
<div class="code">
<pre>
<code>&lt;- channelA
doA()
&lt;- channelB
doB()
&lt;- channelC
doC()</code>
</pre></div>
<p>It gets worse when the execution requires to preserve some state between the steps:</p>
<div class="code">
<pre>
<code>var varA int = 0
var varB int = 0
var varC int = 0
for {
  select {
  case varA &lt;- channelA:
      doA()
  case varB &lt;- channelB:
      doB(varA)
  case varC &lt;- channelC:
      doC(varB)
  }
}</code>
</pre></div>
<p>What happens if case B is executed before case A? And what happens if C is executed after A, but B is missing? We are facing exponential explosion of complexity.</p>
<p>The latter pattern, on the other hand, keeps complexity at bay:</p>
<div class="code">
<pre>
<code>varA := &lt;- channelA
doA()
varB := &lt;- channelB
doB(varA)
varC := &lt;- channelC
doC(varB)</code>
</pre></div>
<p>Ideally, if we want to preserve our ability to maintain the program and reason about it, we should strive to use the linear pattern and avoid the select-based pattern altogether.</p>
<p>The question is whether every select-based program can be converted into linear program. Or whether getting rid of select necessarily limits the expressiveness of the language.</p>
<p>Let's consider different use cases and see what can be done.</p>
<h2 id="toc2"><span>State Machines and Event Loops</span></h2>
<p>First of all, select-based programming is used in C to write network servers. The idea is to have many TCP connections to clients opened in parallel, to wait for activity on any of them using select(), then to service whoever happens to ask us to do some work. Reader can readily come up with their own examples in different languages and different problem domains.</p>
<p>This pattern is called event-driven programming or state machine approach. An interesting observation is that state machines are one of couple cases where using goto statement still yields nicer code than using structured programming. This isn't at all accidental. What we are facing here is the half a century old Dijkstra's problem resurfacing in the concurrent environment.</p>
<p>If we dig deeper into the network server problem, it can be seen that we can get rid of the state machine approach by forking a separate process for each TCP connection. This is the canonical way to solve the problem in the UNIX tradition, which itself is not that much younger than the original 'considered harmful' paper.</p>
<p>The reason why people use select() nonetheless is simple: Forking a process per TCP connection is simply too expensive. A program that would do so won't be able to cope in modern high performance environment.</p>
<p>So, we are not facing a conceptual limitation, but rather a relatively simple performance issue. And most modern languages do offer a way to fork lightweight processes (called green threads, coroutines, goroutines and so on) that make the option of launching one per TCP connection a viable proposition once again.</p>
<h2 id="toc3"><span>Go and Timeouts</span></h2>
<p>Interestingly, Go, the language that is closest to the original UNIX philosophy, encourages handling network connections this way, but is still features a select{} statement.</p>
<p>We'll explore the remaining use cases in the rest of the article but let's first do away with a trivial case of using select{} for timeouts:</p>
<div class="code">
<pre>
<code>switch {
case time.After(100):
    handleTimeout()
case &lt;- channelA:
    doA()
}</code>
</pre></div>
<p>It seems that timeouts are handled this way in Go because select{} statement was already available and thus the designers of the language took advantage of the mechanism to solve this relatively simple and benign problem. It definitely doesn't look like select{} was introduced to the language because of dire need to solve the menacing timeout problem.</p>
<p>In fact, timeouts can be solved by simply adding an additional parameter to blocking operations. Here's an example in idiomatic C:</p>
<div class="code">
<pre>
<code>int rc = foo(1); /* timeout of 1 second */
if(rc == -1 &amp;&amp; errno == ETIMEDOUT)
    handle_timeout();</code>
</pre></div>
<h2 id="toc4"><span>Two Big Use Cases</span></h2>
<p>That being said, we are left with the cases where select{} is used for parallel communication with different goroutines. These can be split into two big classes. First, there are use cases where we want to communicate with many instances of the same thing. For example, in a network server there may be a goroutine per TCP connection but all of those want to communicate with the main goroutine. Second, there are use cases we want to communicate with different things. For example, we have a random number generating goroutine, a TCP connection goroutine, a statistics gathering goroutine and so on. Main goroutine wants to speak with all of those.</p>
<h2 id="toc5"><span>Unlimited Number of Identical Peers</span></h2>
<p>Let's first tackle the problem of &quot;many of the same type&quot;. Naively, one could create a channel for each of those peers and then use select{} (or rather reflect.Select() which allows for unlimited number of peers) to wait for activity from any of them.</p>
<p>Luckily, Go language already contains a mechanism to deal with this scenario in a clean way. Specifically, single Go channel can be used by many senders and many receivers at the same time. Thus, it works as (de)multiplexing device and removes the need for (de)multiplexing via select{} statement:</p>
<div class="code">
<pre>
<code>ch := make(chan int)
go(worker(ch))
go(worker(ch))
go(worker(ch))
result := &lt;- ch // waits for a message from any of the 3 workers</code>
</pre></div>
<p>One may object that this way we lose the information about which worker is the message coming from. But that's exactly the point. If we are dealing with arbitrary number of instances of the same type we positively don't want to handle each of them in a different way. If we do, they are probably not the same thing after all. For example, we may have a bunch of TCP connections but some of them are HTTP connections while others are SMTP connections. We want to handle them differently. I'll discuss that in the 'different peers' section below.</p>
<p>Before moving there though let's have a look at a slightly confusing scenario of different peers that we want to handle the same way. For example, our application may receive inputs via console, via email or via SMS. These look like different things, but given that any of them provides same kind of input they can be treated as 'multiple instances of the same thing' and connect to the main goroutine via a single channel:</p>
<div class="code">
<pre>
<code>ch := make(chan int)
go(consoleHandler(ch))
go(emailHandler(ch))
go(smsHandler(ch))
result := &lt;- ch // waits for a message from any of the 3 handlers</code>
</pre></div>
<p>The lesson from this example is that word 'same' in the phrase 'many of the same kind' refers to identical semantics, not necessarily to identical implementation.</p>
<h2 id="toc6"><span>Limited Number of Different Peers</span></h2>
<p>Having dealt with the 'same thing' case, let's have a look at how to deal with communicating with different kinds of things.</p>
<div class="code">
<pre>
<code>for {
  select {
  case &lt;- channelA:
      doA()
  case &lt;- channelB:
      doB()
  }
}</code>
</pre></div>
<p>Let's suppose that A and B are completely independent. There's no ordering relationship between doA's and doB's. They can be executed in any order. They don't pass any info each to the other.</p>
<p>In such case each of the handles can be placed into its own goroutine with no need for select{} statement:</p>
<div class="code">
<pre>
<code>func handlerA(channelA chan int) {
    for {
        &lt;- channelA
        doA()
    }
}

func handlerB(channelB chan int) {
    for {
        &lt;- channelB
        doB()
    }
}</code>
</pre></div>
<p>Let's, on the other hand, assume that there is a relationship between A and B. For example, doA returns a value that is then passed to doB. If so the program can be rewritten in linear manner:</p>
<div class="code">
<pre>
<code>for {
    &lt;- channelA
    varA := doA
    &lt;- channelB
    doB(varA)
}</code>
</pre></div>
<p>At this point I would like to claim that any program dealing with limited number of different peers can be transformed into an equivalent program with no select{} statements. It can be done by repeatedly applying the two transformations shown above:</p>
<p>1. Splitting independent stuff into separate processes.<br />
2. Linearisation of the dependent stuff.</p>
<p>TODO: Formal proof. (The raw idea is that if there are two operations, either one is dependent on the other in which case they can be linearised; or they are independent in which case they can be parallelised. Use induction to prove it for any number of operations.)</p>
<h2 id="toc7"><span>Closing Remarks</span></h2>
<p>As a final remark let me note that 'limited number of identical peers' is a trivial case and 'unlimited number of different peers' is not realistic as it would require infinite amount of code.</p>
<p>It was also brought to my attention that doing RPC via channels may be a case where select{} statement is truly needed.</p>
<p>The argument goes like this: Imagine we have one server goroutine and many client goroutines. Client goroutines are sending requests to the server goroutine via a single channel as described above. Each message contains a reference to the reply channel. Server is supposed to process the request and send the result to the reply channel.</p>
<p>And the question is: What happens if the reply cannot be sent to the reply channel straight away? The send operation can't block as that would DoS the entire server. Surely we want to store the reply and select on the reply channel (along with the request channel) until is becomes writable?</p>
<p>Well, no. The channels can already be buffered (in Go, that is). Sufficiently large buffer should smooth out any peakiness in client performance. If the reply cannot be sent it means the buffer is full and thus that there's something wrong with the client. The correct behaviour is such case is shutting the client down and possibly logging the event.</p>
<p>RPC server should be thus implemented like this (unfortunately, the example is written in Go and has to use select{} statement to implement a timeout):</p>
<div class="code">
<pre>
<code>for {
    request := &lt;-requestChannel
    response := processRequest(request)
    select {
    case request.replyChannel &lt;- response:
        continue
    otherwise:
        close(request.replyChannel)
        log.Error(&quot;Oh my God! Oh my God! Something bad happened!&quot;)
    }
}</code>
</pre></div>
<h2 id="toc8"><span>Conclusion</span></h2>
<p>If language contains following features:</p>
<p>1. Lightweight processes.<br />
2. Channels to communicate between them.<br />
3. Many simultaneous senders per channel.<br />
4. Many simultaneous receivers per channel.<br />
5. Ability to make channels buffered.</p>
<p>Then there is no need for select statement.</p>
<p><strong>Martin SÃºstrik, February 20th, 2016</strong></p>
<div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:71">Structured Concurrency</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:73">Footnotes to &quot;Select Statement Considered Harmful&quot;</a></p>
</div>
    
    
    
    </div>
<div style="height:2em"></div>
<div class="comments-box">
		
	<div class="options" id="comments-options-hidden" style="display: none">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.showComments(event)">Show Comments</a> 
	</div>
		
	<div id="thread-container" class="thread-container" style="margin-top: 1em">
					


<script type="text/javascript">
	WIKIDOT.forumThreadId = 1607381;
</script>


	<div class="options" id="comments-options-shown">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.hideComments(event)" class="btn btn-default btn-small btn-sm">Hide All Comments</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.unfoldAll(event)" class="btn btn-default btn-small btn-sm">Unfold All</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.foldAll(event)" class="btn btn-default btn-small btn-sm">Fold All</a>
	</div>

<div id="thread-container-posts" style="display: none">
    



	
					
      
    <div class="post-container" id="fpc-2460324">
                      
		<div class="post" id="post-2460324">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2460324)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2460324">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=055c244e36db3db4b3447b1f830fe302&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Vladimir (guest)</span> <span class="odate time_1455984419 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">20 Feb 2016 16:06</span>
														</div>
			</div>
			<div class="content" id="post-content-2460324">
									

<p>Not all &quot;different kind of peers&quot; cases can be linearized. Simple example: read-write storage with some processing on read and on write. Processing goroutine will look like this:</p>
<div class="code">
<pre>
<code>for {
  select {
  case req := &lt;- readChan:
      req.replyCh &lt;- processReadRequest(req)
  case req := &lt;- writeChan:
      req.replyCh &lt;- processWriteRequest(req)
  }
}</code>
</pre></div>
<p>and there are use-cases when those two channel should not be squashed: different contention policies on those channels, routing, exposing channel(s) as part of API etc.</p>
<p>Another use-case of select - delivering control signals to goroutines. Simplest case - stopping the intermediate goroutine without closing the original channel (i.e. when another goroutine transparently replaces this one), another case - reconfiguring goroutine on the fly (e.g. ajusting throttling, flushing caces etc). The sane out-of-band signalling is important feature that should not be underestimated.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2460324)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2460324)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2460324" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2460324)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2460324)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=055c244e36db3db4b3447b1f830fe302&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Vladimir (guest)</span>, <span class="odate time_1455984419 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">20 Feb 2016 16:06</span>
		</div>
	</div>
 
                
                	


        
                      
    <div class="post-container" id="fpc-2460347">
                      
		<div class="post" id="post-2460347">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2460347)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2460347">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1455988158 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">20 Feb 2016 17:09</span>
														</div>
			</div>
			<div class="content" id="post-content-2460347">
									

<p>The former example seems to be easily parallelisable, i.e. can be split into two goroutines. Am I missing something?</p>
<p>The second case looks more interesting. Both examples cover basically the same scenario. There are two (or more) channels with different QoS connecting two goroutines. I wonder whether implementing a simple prioritised channel wouldn't solve the problem.</p>

							</div>

								
							<div class="changes">
					Last edited on <span class="odate time_1455988175 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">20 Feb 2016 17:09</span>
					by <span class="printuser"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>
					<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showHistory(event,2460347)"><i class="icon-plus"></i> Show more</a>
				</div>
				<div class="revisions" style="display: none"></div>
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2460347)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2460347)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2460347" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2460347)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2460347)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1455988158 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">20 Feb 2016 17:09</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2460353">
                      
		<div class="post" id="post-2460353">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2460353)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2460353">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1455989162 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">20 Feb 2016 17:26</span>
														</div>
			</div>
			<div class="content" id="post-content-2460353">
									

<p>Thinking about it, the classic Go select{} statement doesn't seem to address this scenario either. If chooses one of the active channels at random, ignoring the fact that the two may have different QoS and that it should thus choose the one with higher priority. What's the idiomatic Go way to deal with this kind of stuff?</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2460353)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2460353)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2460353" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2460353)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2460353)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1455989162 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">20 Feb 2016 17:26</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2460500">
                      
		<div class="post" id="post-2460500">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2460500)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2460500">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=2c21bed614c58c9e1c48fe272e79efd2&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Joshua (guest)</span> <span class="odate time_1456018780 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">21 Feb 2016 01:39</span>
														</div>
			</div>
			<div class="content" id="post-content-2460500">
									

<p>select is used when you want to share state between processing more than one channels. You otherwise need mutexes or atomic values which I would argue are harder to get right than just using a select. I've created a fairly complex state machine that would never have been possible without the select.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2460500)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2460500)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2460500" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2460500)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2460500)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=2c21bed614c58c9e1c48fe272e79efd2&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Joshua (guest)</span>, <span class="odate time_1456018780 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">21 Feb 2016 01:39</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2460528">
                      
		<div class="post" id="post-2460528">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2460528)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2460528">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1456025542 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">21 Feb 2016 03:32</span>
														</div>
			</div>
			<div class="content" id="post-content-2460528">
									

<p>Can you be more specific about the scenario which can't be implemented without select?</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2460528)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2460528)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2460528" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2460528)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2460528)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1456025542 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">21 Feb 2016 03:32</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2461986">
                      
		<div class="post" id="post-2461986">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2461986)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2461986">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=2c21bed614c58c9e1c48fe272e79efd2&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Joshua (guest)</span> <span class="odate time_1456247848 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 17:17</span>
														</div>
			</div>
			<div class="content" id="post-content-2461986">
									

<p>The most common scenario is where I have a channel for data and a second channel for management commands. The management commands how data is processed, and the data is the data to be processed. I could implement an envelope for both the data and the management so that it can go over the same channel, but I lose the protection of having an internal only management channel. I think this is still better than setting up various mutexs to have an internal store for the management state.</p>

							</div>

								
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,2461986)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2461986" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2461986)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2461986)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=2c21bed614c58c9e1c48fe272e79efd2&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Joshua (guest)</span>, <span class="odate time_1456247848 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 17:17</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-2461995">
                      
		<div class="post" id="post-2461995">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2461995)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2461995">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1456248140 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 17:22</span>
														</div>
			</div>
			<div class="content" id="post-content-2461995">
									

<p>Yes. That's the hand-crafted scheduling scenario. I've just written about it in the next blog post.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2461995)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2461995)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2461995" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2461995)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2461995)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1456248140 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 17:22</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2461701">
                      
		<div class="post" id="post-2461701">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2461701)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2461701">
																		minimal example
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/fritz-obermeyer" onclick="WIKIDOT.page.listeners.userInfo(2553776); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=2553776&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="Fritz Obermeyer" style="background-image:url(http://www.wikidot.com/userkarma.php?u=2553776)"/></a><a href="http://www.wikidot.com/user:info/fritz-obermeyer" onclick="WIKIDOT.page.listeners.userInfo(2553776); return false;" >Fritz Obermeyer</a></span> <span class="odate time_1456200665 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 04:11</span>
														</div>
			</div>
			<div class="content" id="post-content-2461701">
									

<p>I think both Vladimir and Joshua are thinking about a stateful read-write interface like</p>
<div class="code">
<pre>
<code>var counter int = 0
for {
  select {
  case req := &lt;-readChan:
    req.replyCh &lt;- counter
  case delta := &lt;-writeChan:
    counter += delta
  }
}</code>
</pre></div>
<br />
Would you transform this pattern to pub-sub?
							</div>

								
							<div class="changes">
					Last edited on <span class="odate time_1456203842 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 05:04</span>
					by <span class="printuser"><a href="http://www.wikidot.com/user:info/fritz-obermeyer" onclick="WIKIDOT.page.listeners.userInfo(2553776); return false;" >Fritz Obermeyer</a></span>
					<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showHistory(event,2461701)"><i class="icon-plus"></i> Show more</a>
				</div>
				<div class="revisions" style="display: none"></div>
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2461701)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2461701)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2461701" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2461701)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2461701)">minimal example</a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/fritz-obermeyer" onclick="WIKIDOT.page.listeners.userInfo(2553776); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=2553776&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="Fritz Obermeyer" style="background-image:url(http://www.wikidot.com/userkarma.php?u=2553776)"/></a><a href="http://www.wikidot.com/user:info/fritz-obermeyer" onclick="WIKIDOT.page.listeners.userInfo(2553776); return false;" >Fritz Obermeyer</a></span>, <span class="odate time_1456200665 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 04:11</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2461763">
                      
		<div class="post" id="post-2461763">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2461763)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2461763">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/fritz-obermeyer" onclick="WIKIDOT.page.listeners.userInfo(2553776); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=2553776&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="Fritz Obermeyer" style="background-image:url(http://www.wikidot.com/userkarma.php?u=2553776)"/></a><a href="http://www.wikidot.com/user:info/fritz-obermeyer" onclick="WIKIDOT.page.listeners.userInfo(2553776); return false;" >Fritz Obermeyer</a></span> <span class="odate time_1456214121 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 07:55</span>
														</div>
			</div>
			<div class="content" id="post-content-2461763">
									

<p>Another possible counterexample is in push/pull dataflow frameworks like gstreamer, where data can be either pushed (as a message) or pulled (as a request,reply pair). Of the four adapters between push,pull connections, three can be written without select (push-&gt;push, pull-&gt;pull, pull-&gt;push), but I believe the push-&gt;pull adapter (aka buffer) needs a select. It is useful for e.g. adapting between different sampling rates of audio vs video streams.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2461763)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2461763)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2461763" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2461763)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2461763)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/fritz-obermeyer" onclick="WIKIDOT.page.listeners.userInfo(2553776); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=2553776&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="Fritz Obermeyer" style="background-image:url(http://www.wikidot.com/userkarma.php?u=2553776)"/></a><a href="http://www.wikidot.com/user:info/fritz-obermeyer" onclick="WIKIDOT.page.listeners.userInfo(2553776); return false;" >Fritz Obermeyer</a></span>, <span class="odate time_1456214121 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 07:55</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2461769">
                      
		<div class="post" id="post-2461769">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2461769)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2461769">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1456214723 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 08:05</span>
														</div>
			</div>
			<div class="content" id="post-content-2461769">
									

<p>As for push-&gt;pull scenario, I am not sure I fully understand the question, but if buffer is needed, why not just use a channel to buffer the data?</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2461769)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2461769)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2461769" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2461769)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2461769)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1456214723 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 08:05</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
                      
    <div class="post-container" id="fpc-2461768">
                      
		<div class="post" id="post-2461768">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2461768)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2461768">
																		Re: minimal example
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1456214505 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 08:01</span>
														</div>
			</div>
			<div class="content" id="post-content-2461768">
									

<p>Why are read and write requests passed on different channels? One would rather expect something like:</p>
<div class="code">
<pre>
<code>for {
   req := &lt;- reqChan
   switch req.type {
   case READ:
       ...
    case WRITE:
       ...
   }
}</code>
</pre></div>
<p>Anyway even in the case of two separate channels, these can be funneled to a single channel by having two helper coroutines (read and write). They would write requests to a single request queue, which would then be serviced as shown above.</p>
<p>To put it in a different way. The commands (reads &amp; writes) have to be sequentialised at some point. This is typically done in the client (user can do only one command at a time). Still you can have an advanced client which is capable of multiple overlapping operations, or, which is really the same thing, multiple independent clients. Even in that case the commands have to be sequentialized before reaching the DB engine. This can be done either by having a separate channel for each client and doing select{}, or simply by having a single channel that all the clients write to. The latter is, IMO, preferable from the point of view of readability and maintainability.</p>

							</div>

								
							<div class="changes">
					Last edited on <span class="odate time_1456215964 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 08:26</span>
					by <span class="printuser"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>
					<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showHistory(event,2461768)"><i class="icon-plus"></i> Show more</a>
				</div>
				<div class="revisions" style="display: none"></div>
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2461768)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2461768)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2461768" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2461768)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2461768)">Re: minimal example</a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1456214505 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 08:01</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2511007">
                      
		<div class="post" id="post-2511007">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2511007)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2511007">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=d418ccebe2e0fb4d6b55e1a1215e32c3&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>rmoe (guest)</span> <span class="odate time_1463580923 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">18 May 2016 14:15</span>
														</div>
			</div>
			<div class="content" id="post-content-2511007">
									

<p>&quot;Go, the language that is closest to the original UNIX philosophy&quot;</p>
<p>With all due respect: Such a statement without being properly laid out and being profoundly substantiated, to me simply translates to &quot;OK, we have a fan boys writing here&quot;; it's basically a disqalification.</p>
<p>Don't get me wrong, I *do* think that languages are of high importance and that it's about time to have a profound (and even mistrusting) look at them (outside of academia). I *do* agree that some languages are better for the kind of job you're discussing here, that some are less attractive and that some - some major languages among them! - are rightout evil and dangerous.</p>
<p>So, a statement like &quot;X is closest to the original UNIX philosophy&quot; or &quot;Y is the best language for safe, reliable and performant network servers&quot; may quite well be justified and valuable, even desirable. It must, however, be very carefully laid out and substantiated.<br />
If it isn't I take it to be worthless blunder from a fanboy.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2511007)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2511007)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2511007" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2511007)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2511007)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=d418ccebe2e0fb4d6b55e1a1215e32c3&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>rmoe (guest)</span>, <span class="odate time_1463580923 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">18 May 2016 14:15</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2511023">
                      
		<div class="post" id="post-2511023">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2511023)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2511023">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1463582777 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">18 May 2016 14:46</span>
														</div>
			</div>
			<div class="content" id="post-content-2511023">
									

<p>I don't really care whether it's closest. But Ken Thompson is one of the authors of Go, so shrug, whatever.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2511023)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2511023)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2511023" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2511023)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2511023)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263557" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1463582777 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">18 May 2016 14:46</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-4429737">
                      
		<div class="post" id="post-4429737">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4429737)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4429737">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=30bf863023e45263c263fc6a2cfadbef&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>mentalisttraceur (guest)</span> <span class="odate time_1574485943 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Nov 2019 05:12</span>
														</div>
			</div>
			<div class="content" id="post-content-4429737">
									

<p>To me that statement about Go being the closest to the UNIX philosophy was self-evidently true the moment I read it.</p>
<p>It's actually insightful in a deep way, but I think rmoe is reading a different meaning into it, a more value-judgement-feely meaning instead of the common-pattern-identifying meaning, probably because the design decision parallels and similarities are somewhat &quot;gated truths&quot; - it's only obvious to me what you meant because I have spent a really large amount of time thinking about the relevant design considerations, the underlying unifying base principles on top of which a lot of systems and languages were built.</p>
<p>I think rmoe is right in the sense that obviously those who don't already &quot;see it&quot; are liable to misinterpret that statement or have a negative reaction to it, just like rmoe did. But it's not an absolute, and if you're writing for the audience of people who already get it or are willing to do good-faith idea-fitting on the statement, taking the time to justify it has limited value, and from experience I can say even counter-productive.</p>
<p>So I'm here to say the statement was good, right, and while I'm sympathetic to rmoe's critique, I am glad you just wrote it simply at face value and moved on - it worked well for me.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4429737)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4429737)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4429737" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4429737)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4429737)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=30bf863023e45263c263fc6a2cfadbef&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>mentalisttraceur (guest)</span>, <span class="odate time_1574485943 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Nov 2019 05:12</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2769991">
                      
		<div class="post" id="post-2769991">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2769991)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2769991">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=c9270a3f8bde4dfd742ee5c52a4fdbca&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Sriram Srinivasan (guest)</span> <span class="odate time_1489816388 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">18 Mar 2017 05:53</span>
														</div>
			</div>
			<div class="content" id="post-content-2769991">
									

<p>I think your argument is about structuring state machines, not that much about select. Without indepdependly schedulable lightweight threads, one is forced to conflate logically hierarchical (or peer) state machines all into one. I agree with you that with Goroutines, many state machines can be broken up into tinier, hierarchically related ones.</p>
<p>However, you still need select, since it is the equivalent of nondeterministic choice in CSP, and it is a primitive in the latter for a reason. So, point #2 just before your conclusion is not always possible because there is no linearization there. Independent signals (timeouts, cancellations, peer failures, aasync i/o completion etc) are all possibilities, and they may or may not happen. You have to account for a powerset of the possibilities in any execution.</p>
<p>The suggestion of putting all such signals into a single channel to avoid select is fraught with problems:</p>
<p>1. The receiver dictates the type of the channel to be the union of all incoming signals, so the source has to know details that it is completely unconcerned with.</p>
<p>2. Erlang has the model you suggest. At the same time, the language has built-in support for selective receive (which is select in a different form), yet head of line blocking gets in the way more often than you think. In Go, you have to build selective receive yourself, but the essential problem doesn't go away.</p>
<p>3. Flow control affects all sources. There are good arguments against unlimited buffering, and bounded buffered channels impose flow control: one busy source can basically keep out another source feeding to the same channel.</p>
<p>4. This scheme doesn't get rid of nondeterminism anywway, because the first thing the receiver must do is to demultiplex the message and process it. It is identical to the select code.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2769991)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2769991)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2769991" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2769991)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2769991)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=c9270a3f8bde4dfd742ee5c52a4fdbca&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Sriram Srinivasan (guest)</span>, <span class="odate time_1489816388 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">18 Mar 2017 05:53</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4213724">
                      
		<div class="post" id="post-4213724">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4213724)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4213724">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=98d2cf5926e56bc917fd79b50dd6e52c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>John Freeman (guest)</span> <span class="odate time_1554820593 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">09 Apr 2019 14:36</span>
														</div>
			</div>
			<div class="content" id="post-content-4213724">
									

<p>Two problems with your argument against select for timeouts:</p>
<p>1. Separation of concerns. When I'm writing code, I don't want to be thinking &quot;oh I need to remember to add a timeout parameter to every function.&quot; I want to handle timeouts orthogonally to everything else.</p>
<p>2. Composition. If I want to compose N sub-operations into one operation governed by a single timeout, then without select I must record the running time of every sub-operation, subtract it from the time remaining, and feed that as the timeout to the next sub-operation. It's onerous and causes drift in the timeout that scales with the number of sub-operations.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4213724)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4213724)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4213724" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4213724)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4213724)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=98d2cf5926e56bc917fd79b50dd6e52c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>John Freeman (guest)</span>, <span class="odate time_1554820593 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">09 Apr 2019 14:36</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-4429755">
                      
		<div class="post" id="post-4429755">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4429755)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4429755">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=30bf863023e45263c263fc6a2cfadbef&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>mentalisttraceur (guest)</span> <span class="odate time_1574488045 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Nov 2019 05:47</span>
														</div>
			</div>
			<div class="content" id="post-content-4429755">
									

<p>I think these two problems are easily addressed:</p>
<p>1. If the underlying system deeply supports timeouts or cancellations - at every blocking operation or context switch for example - then you *never* have to remember to add a timeout parameter - callers can just impose timeouts on every operation within some scope wherever appropriate. Both this blog author's libdill in C and the very nice trio library in Python are examples of this - assuming the entire system is written on top of primitives that can be timedout or cancelled, timeouts come for free, everywhere.</p>
<p>Which actually gets you the timeouts handled orthogonally that you wanted, just like Go's select on a timeout channel does.</p>
<p>2. This is actually solved by the same way that I described in the previous point - if the underlying primitives can be timed out or cancelled in a scoped way then you get that feature for free.</p>
<p>But if you didn't, that's actually a really trivial pattern to abstract - I have a library that boils down to like ten lines of essential code which lets you do something like (Go-like pseudocode):</p>
<p>timeout := totaltimeout.Timeout(5 * time.Seconds)<br />
someOperation1(&#8230;, timeout.TimeLeft())<br />
someOperation2(&#8230;, timeout.TimeLeft())<br />
&#8230;<br />
someOperationN(&#8230;, timeout.TimeLeft())</p>
<p>and so long as your operations handle zero for the timeout as a &quot;bail immediately&quot; (which can be trivially ensured with a wrapper function if they don't), it works exactly as intended.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4429755)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4429755)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4429755" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4429755)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4429755)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=30bf863023e45263c263fc6a2cfadbef&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>mentalisttraceur (guest)</span>, <span class="odate time_1574488045 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Nov 2019 05:47</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4429771">
                      
		<div class="post" id="post-4429771">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4429771)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4429771">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=30bf863023e45263c263fc6a2cfadbef&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>mentalisttraceur (guest)</span> <span class="odate time_1574490458 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Nov 2019 06:27</span>
														</div>
			</div>
			<div class="content" id="post-content-4429771">
									

<p>One case I don't see obviously cleanly handled by this model, either here or in the follow-up footnote post, is that of collating multiple data sources into different updates to the same state.</p>
<p>Actually I just thought of a solution when I came back after a few hours to write this comment, so this does fit into the model, but I'll write the rest of the post for anyone else who it helps.</p>
<p>For example, I have a program right now which receives information from many different data sources about some networked devices we have. (The data sources are various systems that directly or indirectly talk to our networked devices, or have insights into the devices or their activity for other reasons.)</p>
<p>You can picture each data source as a Go or libdill -style channel, where events arrive frequently - nearly constantly - but effectively at random.</p>
<p>Then each of these pieces of information needs to be parsed (different for each source) into a decision about how to modify the in-memory state for each of those networked devices (the state is shared).</p>
<p>At first glance, this is not a &quot;semantically the same&quot; data sources problem, so it cannot be handled as one channel.</p>
<p>At first glance, this can be trivially split into independent coroutines, but it relies on sharing of state and - assuming that the concurrency can also potentially be parallel at any moment, as in Go - requires bringing mutexes into the equation. That seems strictly worse for readability because now the state manipulations are not exactly local in the code.</p>
<p>So I kept feeling like a select on all of these data source channels was the cleanest way, that kept the semantically related code local in the source text.</p>
<p>However, it finally hit me:</p>
<p>1. Decision on if and how to mutate shared state<br />
2. Mutating shared state</p>
<p>These are two semantically separate things, so they actually fit this no-select-statement model beautifully.</p>
<p>Separate coroutines can read each data source channel, transform the data into some representation of the state change to make, and then write that representation into a single shared state updates channel.</p>
<p>A single coroutine reads just that channel and applies each state change.</p>
<p>Evidence through concilience that this is actually a good idea - doing this automatically factors the logic into more easily testable pieces - the state changes are either data which can be fed into the logic that applies them, or functions which are given the state to update as an argument - each of which lends itself way more easily to unit testing, fuzzing, model-based testing, etc.</p>
<p>You're onto something real and significant here Sustrik.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4429771)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4429771)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4429771" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4429771)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4429771)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=30bf863023e45263c263fc6a2cfadbef&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>mentalisttraceur (guest)</span>, <span class="odate time_1574490458 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Nov 2019 06:27</span>
		</div>
	</div>
 
                
        
            </div>
 



</div>

        <a href="javascript:;" id="new-post-button" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.newPost(event,null)"
      style="display:  none ; margin-bottom:1em"
    >Add a New Comment</a>


    <div id="new-post-form-container">
        <div id="new-post-preview-div" style="display: none">
            <h1>Post preview:</h1>
            <div class="post-container"></div>
            <div></div>
            <a href="javascript:;" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.closePreview(event)" class="btn btn-danger">Close preview</a>
        </div>

        <div id="new-post-div" class="well">
            <form id="new-post-form" onkeypress="return OZONE.utils.disableEnterKey(event)">
                <input type="hidden" name="threadId" value="1607381"/>
                <input type="hidden" name="parentId" value=""/>
                                    <table class="guest-commenting">
                        <tr>
                            <td><input class="text form-control" name="guestName" type="text" maxlength="30" value="" title="Name"/></td>
                            <td>or <a href="#action:login">Sign in as Wikidot user</a></td>
                        </tr>
                        <tr>
                            <td><input class="text form-control" name="guestEmail" type="text" maxlength="50" value="" title="E-mail address"/></td>
                            <td>(will not be published)</td>
                        </tr>
                    </table>
                                <div><textarea id="np-text" name="source" rows="10" cols="50" class="form-control"></textarea></div>
                <div class="change-textarea-size">
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',-5)">-</a>
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',5)">+</a>
                </div>
                <div class="edit-help-34">
                    Help: <a href="http://www.wikidot.com/doc:quick-reference" target="_blank">wiki text quick reference</a>                </div>
                                
                <div id="edit-post-captcha"></div>
                
                <div class="buttons alignleft">
                    <input class="btn btn-danger btn-small btn-sm" type="button" value="Cancel" id="np-cancel" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.cancel(event)"/>
                    <input class="btn btn-default btn-small btn-sm" type="button" value="Preview" id="np-preview" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.preview(event)"/>
                    <input class="btn btn-primary btn-small btn-sm" type="button" value="Post it" id="np-post" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.save(event)"/>
                </div>
                    
            </form>
        </div>	

    </div> 
            <script type="text/javascript">
            
            $j(function() {
                WIKIDOT.Editor.init("np-text", "np-editor-panel");
            });
            
        </script>
    
 

<div style="display:none" id="post-options-template">
	<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showPermalink(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Permanent Link</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.editPost(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Edit</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.deletePost(event,'%POST_ID%')" class="btn btn-danger btn-small btn-sm">Delete</a>
</div>
	
			</div>
	
	
	
</div></div>

                    </div>

                    


                    



                    

                    <div id="page-info-break"></div>
                    
                        <div id="page-options-container">
                            
                        </div>
                    
                    <div id="action-area" style="display: none;"></div>
                </div>
            </div>
            
            
            
            <div id="footer" style="display: block; visibility: visible;">
                <div class="options" style="display: block; visibility: visible;">
    <a href="http://www.wikidot.com/doc" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:terms-of-service" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:privacy-policy" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="http://www.wikidot.com">Wikidot.com</a> 
            </div>
            
                <div id="license-area" class="license-area">
                    Unless otherwise stated, the content of this page is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 License</a>
                </div>
            
            
            



            <div id="extrac-div-1"><span></span></div><div id="extrac-div-2"><span></span></div><div id="extrac-div-3"><span></span></div>
            
            
            
            
                
            
        </div>
        
    </div>
<!-- These extra divs/spans may be used as catch-alls to add extra imagery. -->
<div id="extra-div-1"><span></span></div><div id="extra-div-2"><span></span></div><div id="extra-div-3"><span></span></div>
<div id="extra-div-4"><span></span></div><div id="extra-div-5"><span></span></div><div id="extra-div-6"><span></span></div>
</div>




</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- Quantcast -->
    <script type="text/javascript">
    _qoptions={
        qacct:"p-edL3gsnUjJzw-"
    };
    (function() {
        var qc = document.createElement('script'); qc.type = 'text/javascript'; qc.async = true;
        qc.src = ('https:' == document.location.protocol ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(qc, s);
    })();
    </script>
    <noscript>
        <img src="http://pixel.quantserve.com/pixel/p-edL3gsnUjJzw-.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
    </noscript>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>
</html>