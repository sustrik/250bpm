<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Using likely() and unlikely() - 250bpm</title>
    
    	<script type="text/javascript" src="http://www.wikidot.com/default__flow/login__CustomDomainScript?site_id=148706"></script>

    
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = 'http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "250bpm.com";
        WIKIREQUEST.info.siteId = 148706;
        WIKIREQUEST.info.siteUnixName = "250bpm";
        WIKIREQUEST.info.categoryId = 2550760;
        WIKIREQUEST.info.themeId = 18520;
        WIKIREQUEST.info.requestPageName = "blog:6";
        OZONE.request.timestamp = 1594263445;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "blog:6";
        WIKIREQUEST.info.pageId = 13609556;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/WIKIDOT.combined.js"></script>
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
        
                
        /* theme */
                    @import url(http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--theme/base/css/style.css);
                    @import url(http://250bpm.wdfiles.com/local--theme/250bpm/style.css);
            </style>
    
        
        
        
    <link rel="shortcut icon" href="/local--favicon/favicon.gif"/>
    <link rel="icon" type="image/gif" href="/local--favicon/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="/common--images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/common--images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/common--images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-3207370-9']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
        <link rel="manifest" href="/onesignal/manifest.json" />
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" acync=""></script>
    <script>
        var OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
          OneSignal.init({
            appId: null,
          });
        });
    </script>
        
<link rel="alternate" type="application/rss+xml" title="Comments for the page &quot;Using likely() and unlikely()&quot;" href="/feed/page/comments-13609556.xml"/><script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumCommentsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadPostsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/sub/ForumNewPostFormModule.js"></script>
</head>
<body id="html-body">
<div id="skrollr-body">
<a name="page-top"></a>





<div id="container-wrap-wrap">
    <div id="container-wrap">
        <div id="container">
            <div id="header">
              <h1><a href="/"><span>250bpm</span></a></h1>
                
                
                <!-- google_ad_section_start(weight=ignore) -->
                
                <div id="search-top-box" class="form-search">
    <form id="search-top-box-form" action="dummy" class="input-append">
        <input id="search-top-box-input" class="text empty search-query" type="text" size="15" name="query" value="Search this site" onfocus="if(YAHOO.util.Dom.hasClass(this, 'empty')){YAHOO.util.Dom.removeClass(this,'empty'); this.value='';}"/><input class="button btn" type="submit" name="search" value="Search"/>
    </form>
</div>
                
                
                    <div id="top-bar">
                        

<ul>
<li><a href="/">Home</a></li>
<li><a href="https://github.com/sustrik/cartesian">Cartesian</a></li>
<li><a href="http://libdill.org">Libdill</a></li>
<li><a href="http://nanomsg.org">Nanomsg</a></li>
<li><a href="https://github.com/sustrik/tiles">Tiles</a></li>
<li><a href="http://zero.mq">ZeroMQ</a></li>
<li><a href="/contact">Contact</a></li>
</ul>

                    </div>
                
                <div id="login-status"><a href="javascript:;" onclick="WIKIDOT.page.listeners.createAccount(event)" class="login-status-create-account btn">Create account</a> <span>or</span> <a href="javascript:;" onclick="WIKIDOT.page.listeners.loginClick(event)" class="login-status-sign-in btn btn-primary">Sign in</a> </div>
                <div id="header-extra-div-1"><span></span></div><div id="header-extra-div-2"><span></span></div><div id="header-extra-div-3"><span></span></div>
            </div>
            
            <div id="content-wrap">
                
                    <div id="side-bar">
                        


                        


                        


                    </div>
                
                
                <!-- google_ad_section_end -->
                
                <div id="main-content">
                    <div id="action-area-top"></div>
                    
                    
                        <div id="page-title">
                            Using likely() and unlikely()
                        </div>
                    

                    

                    



                    <div id="page-content">
                        

<div style="width:50em"><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:5">Distributed Computing: The Survey Pattern</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:7">Does GPL hurt free software?</a></p>
</div>
    
    
    
    </div>
<div style="width:50em">
<p>If you ever skimmed linux kernel code may have noticed that condition expressions are often marked as either 'likely' or 'unlikely':</p>
<div class="code">
<pre>
<code>if (likely (i == 0)) {
    ...
}</code>
</pre></div>
<p>What is it good for?</p>
<p>These directives are translated into the following GCC directives:</p>
<div class="code">
<pre>
<code>#define likely(x) __builtin_expect ((x), 1)
#define unlikely(x) __builtin_expect ((x), 0)</code>
</pre></div>
<p>These in turn instruct the compiler which branch of the program should be faster and which may execute slower.</p>
<p>To understand how it works we need to understand few details about modern CPUs. Most importantly, that accessing memory is extremely slow when compared to other CPU operations. An operation requiring memory access can take literally 100 times longer to execute than an operation using CPU registers.</p>
<p>To mitigate the problem, CPU designers have come with the concept of CPU caches. The idea is that part of memory currently in use is copied from the memory into the CPU itself. That way you gain an order of magnitude improvement in performance.</p>
<p>The obvious problem with that is that the size of CPU cache is limited in size. You can't copy entire memory into it. So, the CPU has to guess which memory is going to be used in the near future and load that memory into the CPU cache. The algorithms for doing that can be as simple as 'memory that was used most recently is the most likely to be used in the future' or more sophisticated like 'it the program is using memory at address X now, it is likely to use memory at address X+1 in a short time&quot;.</p>
<p>Whatever the case, failure to predict which memory is going to be used results in so called &quot;cache miss&quot; and operation that would otherwise take 1 nanosecond will suddenly take 30 nanoseconds. Consequently, most of the micro-optimisation work done today deals with avoiding cache misses.</p>
<p>Another piece of the puzzle is the fact that the algorithms themselves are stored as data. The machine instructions reside in the memory and have to be accessed in the same way as data in text documents, images, databases etc. What that means is that if program jumps to an address that is not currently in the CPU cache, the execution of program hangs up for say 30 nanoseconds, till next instruction is loaded from the memory.</p>
<div class="image-container aligncenter"><img src="http://250bpm.wdfiles.com/local--files/blog:6/likely1.png" alt="likely1.png" class="image" /></div>
<p>Now, what if the jump is conditional? Obviously one path will simply continue executing the subsequent instructions which happen to be already loaded in the CPU cache. The other path jumps to another memory location and thus risks a cache miss and the associated performance penalty:</p>
<div class="image-container aligncenter"><img src="http://250bpm.wdfiles.com/local--files/blog:6/likely2.png" alt="likely2.png" class="image" /></div>
<p>In short, when there's a conditional jump (it-then-else statement in high-level languages) there will necessarily be a &quot;slow&quot; path and a &quot;fast&quot; path. And it's up to you, as a programmer, to decide what code to put on the fast path and which should go to the slow path.</p>
<p>Imagine this piece of code:</p>
<div class="code">
<pre>
<code>if (nuclear_reactor_leaking)
   goto emergency;

/*  Do routine maintenance here. */
...

emergency:
/*  Start emergency procedure here. */
...</code>
</pre></div>
<p>When the nuclear reactor is leaking the execution jumps to another memory location and is likely to experience a cache miss. Thus, handling of the emergency condition is postponed by 30 nanoseconds.</p>
<p>On the other hand, if the nuclear reactor is working as expected the routine maintenance is executed extremely fast, with no cache misses.</p>
<p>Obviously, this is not the desired behaviour. We should re-write the above code in the following manner:</p>
<div class="code">
<pre>
<code>if (!nuclear_reactor_leaking)
   goto maintenance;

/*  Start emergency procedure here. */
...

maintenance:
/*  Do routine maintenance here. */
...</code>
</pre></div>
<p>However, even in this case the compiler is free to re-order the layout of the code in the memory. Such re-ordering is often done during the optimisation phase of the compilation. Here's where <em>likely()</em> and <em>unlikely()</em> macros come to help. They instruct the compiler about how to layout the branches in the memory. We can re-write the above program this way:</p>
<div class="code">
<pre>
<code>if (likely (nuclear_reactor_leaking)) {
     /*  Start emergency procedure here. */
     ...
}
else {
    /*  Do routine maintenance here. */
    ...
}</code>
</pre></div>
<p>So far so good.</p>
<p>However, have a look at the last code sample once again. Have you noticed anything strange?</p>
<p>Well, nuclear reactor leakage is not likely. Just the opposite. It is extremely rare. And yet we are supposed to mark it as &quot;likely&quot;. Yuck!</p>
<p>And this is the point I want to make in this article: <em>likely()</em> and <em>unlikely()</em> macros have stupid names. Actually, the names are seriously misleading.</p>
<p>I've seen people reasoning this way: &quot;This patch is going to be executed in 90% of cases, so let's mark is as likely.&quot; While the reasoning may work well in most cases, applying it to our nuclear reactor example means doing the exact opposite of what's needed.</p>
<p>I've even seem people reason like this: &quot;This branch is short and it will execute quickly. Let's mark it as likely.&quot; Once again, this may work well in most cases, but won't work for the nuclear reactor example. However short and efficient the maintenance procedure is, it should never be marked as likely. It's always the emergency procedure that should be tagged as likely, irrespective of how long and slow it happens to be.</p>
<p>In short, when you are thinking about whether to mark a branch as likely or unlikely, you should not ask about it existing performance characteristics (How often does it get called? How long does it execute? Etc.) but rather ask yourself about your intended performance characteristics (Do I want this branch to be fast? Can I tolarate a little delay in this branch? Etc.)</p>
<p>The rule of the thumb is: Mark branch that you want to be executed quickly as &quot;likely&quot; and the other branch as &quot;unlikely&quot;.</p>
<p>You can even formalise this rule in the following way:</p>
<div class="code">
<pre>
<code>#define accelerate(x) likely(x)
#define decelerate(x) unlikely(x)</code>
</pre></div>
<p>And our nuclear reactor example would now look like this:</p>
<div class="code">
<pre>
<code>if (accelerate (nuclear_reactor_leaking)) {
     /*  Start emergency procedure here. */
     ...
}
else {
    /*  Do routine maintenance here. */
    ...
}</code>
</pre></div>
<p>Makes more sense now, doesn't it?</p>
</div>
<p><strong>Martin SÃºstrik, Jun 22th, 2012</strong></p>
<div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:5">Distributed Computing: The Survey Pattern</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:7">Does GPL hurt free software?</a></p>
</div>
    
    
    
    </div>
<div style="height:2em"></div>
<div class="comments-box">
		
	<div class="options" id="comments-options-hidden" style="display: none">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.showComments(event)">Show Comments</a> 
	</div>
		
	<div id="thread-container" class="thread-container" style="margin-top: 1em">
					


<script type="text/javascript">
	WIKIDOT.forumThreadId = 511529;
</script>


	<div class="options" id="comments-options-shown">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.hideComments(event)" class="btn btn-default btn-small btn-sm">Hide All Comments</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.unfoldAll(event)" class="btn btn-default btn-small btn-sm">Unfold All</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.foldAll(event)" class="btn btn-default btn-small btn-sm">Fold All</a>
	</div>

<div id="thread-container-posts" style="display: none">
    



	
					
      
    <div class="post-container" id="fpc-1486892">
                      
		<div class="post" id="post-1486892">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1486892)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1486892">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=e355b4dfb50b17c3543745202c139b07&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Al Nonymous (guest)</span> <span class="odate time_1340353679 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">22 Jun 2012 08:27</span>
														</div>
			</div>
			<div class="content" id="post-content-1486892">
									

<p>&#8230;and now every condition is tagged with accelerate() in hopes it makes it execute faster. :)</p>
<p>How about prioritize() ? Sounds appropriate. Not sure what the opposite should be though.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,1486892)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,1486892)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1486892" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1486892)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1486892)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=e355b4dfb50b17c3543745202c139b07&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Al Nonymous (guest)</span>, <span class="odate time_1340353679 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">22 Jun 2012 08:27</span>
		</div>
	</div>
 
                
                	


        
                      
    <div class="post-container" id="fpc-1486898">
                      
		<div class="post" id="post-1486898">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1486898)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1486898">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594262774" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1340354925 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">22 Jun 2012 08:48</span>
														</div>
			</div>
			<div class="content" id="post-content-1486898">
									

<p>The trouble is the if statement without an else clause. Then the likely/unlikely doesn't even make sense. Maybe a construct that enforces the it-then-else structure would help? fast_if (x) &#8230; else_slow &#8230; (the point would be to make compilation fail if else_slow clause would not be present)</p>

							</div>

								
							<div class="changes">
					Last edited on <span class="odate time_1340354999 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">22 Jun 2012 08:49</span>
					by <span class="printuser"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>
					<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showHistory(event,1486898)"><i class="icon-plus"></i> Show more</a>
				</div>
				<div class="revisions" style="display: none"></div>
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,1486898)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,1486898)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1486898" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1486898)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1486898)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594262774" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1340354925 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">22 Jun 2012 08:48</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-1531273">
                      
		<div class="post" id="post-1531273">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1531273)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1531273">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=7ab06e505e0369ce3f17324f3b15ef9f&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Aszarsha (guest)</span> <span class="odate time_1344438673 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">08 Aug 2012 15:11</span>
														</div>
			</div>
			<div class="content" id="post-content-1531273">
									

<p>Your reasoning is wrong.</p>
<p>if( unlikely( &#8230; ) ) { &#8230; } makes perfect sense.<br />
The if branch can be scheduled at the end of the function. Either it ret, call an unwind thunk, or jump back after the conditional check.</p>

							</div>

								
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,1531273)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1531273" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1531273)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1531273)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=7ab06e505e0369ce3f17324f3b15ef9f&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Aszarsha (guest)</span>, <span class="odate time_1344438673 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">08 Aug 2012 15:11</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-1535661">
                      
		<div class="post" id="post-1535661">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1535661)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1535661">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594262774" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1344843597 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">13 Aug 2012 07:39</span>
														</div>
			</div>
			<div class="content" id="post-content-1535661">
									

<p>Oops. You are right.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,1535661)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,1535661)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1535661" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1535661)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1535661)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594262774" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1344843597 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">13 Aug 2012 07:39</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-1552681">
                      
		<div class="post" id="post-1552681">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1552681)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1552681">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=ca3545e25e79007f0851aa5a6389c643&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>jclairem (guest)</span> <span class="odate time_1346415804 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">31 Aug 2012 12:23</span>
														</div>
			</div>
			<div class="content" id="post-content-1552681">
									

<p>You are missing (or maybe in purposely hiding) a fundamental issue that these macros try to solve: Branch Prediction. Modern CPUs are using pipelining. When CPU predicts the wrong branch it must flush its pipe. That's pretty bad in term of performance. With these macros compiler can add hints for the CPU.</p>
<p>The whole cache thing is mostly hidden by instruction cache prefetching done by the CPU itself. Except if you write very sparse code&#8230;</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,1552681)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,1552681)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1552681" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1552681)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1552681)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=ca3545e25e79007f0851aa5a6389c643&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>jclairem (guest)</span>, <span class="odate time_1346415804 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">31 Aug 2012 12:23</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-1552688">
                      
		<div class="post" id="post-1552688">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1552688)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1552688">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594262774" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1346416639 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">31 Aug 2012 12:37</span>
														</div>
			</div>
			<div class="content" id="post-content-1552688">
									

<p>Yes, but does that break the argument above? The goal is not to tag the code as &quot;probable&quot; or &quot;unprobable&quot;, rather as &quot;I want this branch to be faster than the alternate branch&quot;.</p>
<p>The most probable path may well not be on critical path and thus its performance is irrelevant. The least probable, on the other hand, can be directly on the critical path and should be optimised as much as possible.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,1552688)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,1552688)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1552688" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1552688)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1552688)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594262774" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1346416639 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">31 Aug 2012 12:37</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-1552728">
                      
		<div class="post" id="post-1552728">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1552728)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1552728">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=ca3545e25e79007f0851aa5a6389c643&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>jclairem (guest)</span> <span class="odate time_1346420152 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">31 Aug 2012 13:35</span>
														</div>
			</div>
			<div class="content" id="post-content-1552728">
									

<p>Sure I'm not saying otherwise and that is a good argument.</p>
<p>I was just pointing out that the underlying performance issue is more related to branch mispredictions than cache misses.</p>

							</div>

								
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,1552728)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1552728" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1552728)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1552728)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=ca3545e25e79007f0851aa5a6389c643&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>jclairem (guest)</span>, <span class="odate time_1346420152 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">31 Aug 2012 13:35</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-1554889">
                      
		<div class="post" id="post-1554889">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1554889)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1554889">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=3bedfd8ea4ba99514bae60813fe211fc&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>marc (guest)</span> <span class="odate time_1346666621 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">03 Sep 2012 10:03</span>
														</div>
			</div>
			<div class="content" id="post-content-1554889">
									

<p>I'm not so sure.</p>
<p>I think the point using __builtin_expect is branch prediction, as stated above, by jclairem.</p>
<p>And the problem here is not only the cache misses the code can cause, but the wasted cycles in executing the branch marked as likely (or accelerated) when this is not the most probable branch to be executed. Even though you might want to optimize an unlikely branch because its execution time is critical, if you mark it as &quot;likely&quot; the CPU will start processing that branch every time (or most of the time) the function is called. So, the execution will then have to be thrown away and the CPU cycles will be wasted. Then the most probable executed branch (marked as &quot;unlikely&quot;, to optimize the other one) will have to be executed again and so, the pipeline slowed down because of the branch misprediction.</p>
<p>Furthermore, the CPU has a branch prediction buffer (or something like that) so, if this function is called often, it will &quot;know&quot; that the most probable branch (marked as &quot;unlikely&quot;) is, in fact, the &quot;likely&quot; branch, making the CPU hint totally useless. In case it is not called so often, a branch misprediction will occur for every call.</p>
<p>My apologies for the confusion created by the words [un]likely and most/less probable. It wasn't that easy to put. :P</p>

							</div>

								
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,1554889)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1554889" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1554889)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1554889)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=3bedfd8ea4ba99514bae60813fe211fc&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>marc (guest)</span>, <span class="odate time_1346666621 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">03 Sep 2012 10:03</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-1554902">
                      
		<div class="post" id="post-1554902">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1554902)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1554902">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594262774" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1346668212 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">03 Sep 2012 10:30</span>
														</div>
			</div>
			<div class="content" id="post-content-1554902">
									

<p>You are right that CPU cycles will be wasted. However, the point is that if you are not on a critical path you don't care. No time-sensitive computation is going on anyway.</p>
<p>As for the prediction buffer, I guess there's nothing you can do about it, but even in such case the cache miss argument holds.</p>

							</div>

								
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,1554902)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1554902" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1554902)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1554902)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594262774" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1346668212 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">03 Sep 2012 10:30</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-1554957">
                      
		<div class="post" id="post-1554957">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1554957)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1554957">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=3bedfd8ea4ba99514bae60813fe211fc&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>marc (guest)</span> <span class="odate time_1346673597 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">03 Sep 2012 11:59</span>
														</div>
			</div>
			<div class="content" id="post-content-1554957">
									

<p>I think that to avoid cache misses you just can put the code right after the if condition. The compiler will usually keep the code in that order (first the if block, then the else block; it is still free to reorder single instructions) and so, the &quot;likely&quot; hint will have no effect whatsoever.</p>
<p>I'm not an expert, I'm just thinking out loud. :)</p>
<p>My point here is that I am not so sure about using the __builtin_expect hint for this kind of optimization. But, of course, I might be wrong! ;)</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,1554957)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,1554957)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1554957" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1554957)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1554957)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=3bedfd8ea4ba99514bae60813fe211fc&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>marc (guest)</span>, <span class="odate time_1346673597 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">03 Sep 2012 11:59</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-1782905">
                      
		<div class="post" id="post-1782905">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,1782905)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-1782905">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=1cad2087b968fa3d70543073e4d1f2c7&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>bfig (guest)</span> <span class="odate time_1369442371 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">25 May 2013 00:39</span>
														</div>
			</div>
			<div class="content" id="post-content-1782905">
									

<p>In general you wouldn't want to accelerate a reactor leak more than you consider it to be likely&#8230;</p>
<p>Just saying :).</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,1782905)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,1782905)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-1782905" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,1782905)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,1782905)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=1cad2087b968fa3d70543073e4d1f2c7&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>bfig (guest)</span>, <span class="odate time_1369442371 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">25 May 2013 00:39</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2388908">
                      
		<div class="post" id="post-2388908">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2388908)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2388908">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=10681d32d609168c9d10861d72be9509&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>SteveL (guest)</span> <span class="odate time_1444398804 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">09 Oct 2015 13:53</span>
														</div>
			</div>
			<div class="content" id="post-content-2388908">
									

<p>To agree with others, the issue here is the branch prediction penalty, especially that on CPUs with speculative execution (Pentium Pro onwards for x86). These can happily do a whole sequence of operations, but not committing anything back -like a write to memory- speculatively -that is, based on the expectation that a specific branch will be taken.</p>
<p>Speculation is a key way to get performance even in code with for loops and branches. Instruction cache (I-Cache) misses are generally irrelevant, at least for short if/then/else clauses, because cache line length means that both paths are likely to be nearby.</p>
<p>CPUs usually default to sequential code -the <tt>if() { here }</tt> clause- by default, but maintain a Branch Target Buffer, which remembers the last branch outcome, and takes that one again. They hash the address, so there's always a risk of a misprediction when branches are met again, but generally it works well. Worth noting is that in a <tt>for()</tt> loop, they invariably mispredict the final outcome, when the loop finishes, because every other iteration they took the branch.</p>
<p>The <tt>likely()</tt> clause is presumably adding some hint to the CPU to say &quot;this is the branch that's taken, if you don't have any memory of the previous outcome of this branch&quot;. Where it could be useful is with unlikely() and debug statements:</p>
<p><tt>if (unlikely(level==DEBUG)) logDebug(&quot;core temperature: %s, reactor-&gt;temp);</tt></p>
<p>when debug is disabled, the CPU will skip building the string, so the default production path doesn't waste cycles, not even on the first pass through the code.</p>
<p>For further reading, I'd recommend Patterson and Hennessy, Computer Architecture, A quantitive approach. I'd recommend reading that for its coverage of CPU concurrency in general, as you'll never look at the volatile keyword in the same light ever again.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2388908)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2388908)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2388908" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2388908)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2388908)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=10681d32d609168c9d10861d72be9509&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>SteveL (guest)</span>, <span class="odate time_1444398804 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">09 Oct 2015 13:53</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-3133712">
                      
		<div class="post" id="post-3133712">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,3133712)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-3133712">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=33e568baba35cd1512dcd8adacc393d7&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Arran Cudbard-Bell (guest)</span> <span class="odate time_1499471009 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">07 Jul 2017 23:43</span>
														</div>
			</div>
			<div class="content" id="post-content-3133712">
									

<p>Unless of course the debug level can be altered at runtime, in which case marking all the debug statements as unlikely would be a very bad idea indeed.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,3133712)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,3133712)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-3133712" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,3133712)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,3133712)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=33e568baba35cd1512dcd8adacc393d7&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Arran Cudbard-Bell (guest)</span>, <span class="odate time_1499471009 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">07 Jul 2017 23:43</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-3772967">
                      
		<div class="post" id="post-3772967">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,3772967)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-3772967">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=9391152264f5d5fe5e7f6db2de7ebdcb&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Kuba BerÃ¡nek (guest)</span> <span class="odate time_1524046031 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">18 Apr 2018 10:07</span>
														</div>
			</div>
			<div class="content" id="post-content-3772967">
									

<p>I think that you missed the points of those builtin instructions. Their names are perfectly valid - all they do is to give a hint to the compiler if it should expect that the branch will be taken or not. It is done solely for branch prediction (as is stated in the docs - <a href="https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html">https://gcc.gnu.org/onlinedocs/gcc/Other-Builtins.html</a>).</p>
<p>The problematic thing is that it's often hard to predict this and with the builtin hints you can actually make things worse if you predict it wrong. But in tight loops where you have some inside knowledge about the branches it can help.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,3772967)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,3772967)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-3772967" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,3772967)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,3772967)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=9391152264f5d5fe5e7f6db2de7ebdcb&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Kuba BerÃ¡nek (guest)</span>, <span class="odate time_1524046031 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">18 Apr 2018 10:07</span>
		</div>
	</div>
 
                
        
            </div>
 



</div>

        <a href="javascript:;" id="new-post-button" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.newPost(event,null)"
      style="display:  block ; margin-bottom:1em"
    >Add a New Comment</a>

 

<div style="display:none" id="post-options-template">
	<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showPermalink(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Permanent Link</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.editPost(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Edit</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.deletePost(event,'%POST_ID%')" class="btn btn-danger btn-small btn-sm">Delete</a>
</div>
	
			</div>
	
	
	
</div></div>

                    </div>

                    


                    



                    

                    <div id="page-info-break"></div>
                    
                        <div id="page-options-container">
                            
                        </div>
                    
                    <div id="action-area" style="display: none;"></div>
                </div>
            </div>
            
            
            
            <div id="footer" style="display: block; visibility: visible;">
                <div class="options" style="display: block; visibility: visible;">
    <a href="http://www.wikidot.com/doc" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:terms-of-service" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:privacy-policy" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="http://www.wikidot.com">Wikidot.com</a> 
            </div>
            
                <div id="license-area" class="license-area">
                    Unless otherwise stated, the content of this page is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 License</a>
                </div>
            
            
            



            <div id="extrac-div-1"><span></span></div><div id="extrac-div-2"><span></span></div><div id="extrac-div-3"><span></span></div>
            
            
            
            
                
            
        </div>
        
    </div>
<!-- These extra divs/spans may be used as catch-alls to add extra imagery. -->
<div id="extra-div-1"><span></span></div><div id="extra-div-2"><span></span></div><div id="extra-div-3"><span></span></div>
<div id="extra-div-4"><span></span></div><div id="extra-div-5"><span></span></div><div id="extra-div-6"><span></span></div>
</div>




</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- Quantcast -->
    <script type="text/javascript">
    _qoptions={
        qacct:"p-edL3gsnUjJzw-"
    };
    (function() {
        var qc = document.createElement('script'); qc.type = 'text/javascript'; qc.async = true;
        qc.src = ('https:' == document.location.protocol ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(qc, s);
    })();
    </script>
    <noscript>
        <img src="http://pixel.quantserve.com/pixel/p-edL3gsnUjJzw-.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
    </noscript>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>
</html>