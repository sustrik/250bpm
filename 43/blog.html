<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Magic numbers in C - 250bpm</title>
    
    	<script type="text/javascript" src="http://www.wikidot.com/default__flow/login__CustomDomainScript?site_id=148706"></script>

    
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = 'http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "250bpm.com";
        WIKIREQUEST.info.siteId = 148706;
        WIKIREQUEST.info.siteUnixName = "250bpm";
        WIKIREQUEST.info.categoryId = 2550760;
        WIKIREQUEST.info.themeId = 18520;
        WIKIREQUEST.info.requestPageName = "blog:43";
        OZONE.request.timestamp = 1594263540;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "blog:43";
        WIKIREQUEST.info.pageId = 24193048;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/WIKIDOT.combined.js"></script>
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
        
                
        /* theme */
                    @import url(http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--theme/base/css/style.css);
                    @import url(http://250bpm.wdfiles.com/local--theme/250bpm/style.css);
            </style>
    
        
        
        
    <link rel="shortcut icon" href="/local--favicon/favicon.gif"/>
    <link rel="icon" type="image/gif" href="/local--favicon/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="/common--images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/common--images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/common--images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-3207370-9']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
        <link rel="manifest" href="/onesignal/manifest.json" />
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" acync=""></script>
    <script>
        var OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
          OneSignal.init({
            appId: null,
          });
        });
    </script>
        
<link rel="alternate" type="application/rss+xml" title="Comments for the page &quot;Magic numbers in C&quot;" href="/feed/page/comments-24193048.xml"/><script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumCommentsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadPostsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/sub/ForumNewPostFormModule.js"></script>
</head>
<body id="html-body">
<div id="skrollr-body">
<a name="page-top"></a>





<div id="container-wrap-wrap">
    <div id="container-wrap">
        <div id="container">
            <div id="header">
              <h1><a href="/"><span>250bpm</span></a></h1>
                
                
                <!-- google_ad_section_start(weight=ignore) -->
                
                <div id="search-top-box" class="form-search">
    <form id="search-top-box-form" action="dummy" class="input-append">
        <input id="search-top-box-input" class="text empty search-query" type="text" size="15" name="query" value="Search this site" onfocus="if(YAHOO.util.Dom.hasClass(this, 'empty')){YAHOO.util.Dom.removeClass(this,'empty'); this.value='';}"/><input class="button btn" type="submit" name="search" value="Search"/>
    </form>
</div>
                
                
                    <div id="top-bar">
                        

<ul>
<li><a href="/">Home</a></li>
<li><a href="https://github.com/sustrik/cartesian">Cartesian</a></li>
<li><a href="http://libdill.org">Libdill</a></li>
<li><a href="http://nanomsg.org">Nanomsg</a></li>
<li><a href="https://github.com/sustrik/tiles">Tiles</a></li>
<li><a href="http://zero.mq">ZeroMQ</a></li>
<li><a href="/contact">Contact</a></li>
</ul>

                    </div>
                
                <div id="login-status"><a href="javascript:;" onclick="WIKIDOT.page.listeners.createAccount(event)" class="login-status-create-account btn">Create account</a> <span>or</span> <a href="javascript:;" onclick="WIKIDOT.page.listeners.loginClick(event)" class="login-status-sign-in btn btn-primary">Sign in</a> </div>
                <div id="header-extra-div-1"><span></span></div><div id="header-extra-div-2"><span></span></div><div id="header-extra-div-3"><span></span></div>
            </div>
            
            <div id="content-wrap">
                
                    <div id="side-bar">
                        


                        


                        


                    </div>
                
                
                <!-- google_ad_section_end -->
                
                <div id="main-content">
                    <div id="action-area-top"></div>
                    
                    
                        <div id="page-title">
                            Magic numbers in C
                        </div>
                    

                    

                    



                    <div id="page-content">
                        

<div style="width:50em"><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:42">Are you a programmer-mathematician or a programmer-handyman?</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:44">Bullshit jobs</a></p>
</div>
    
    
    
    </div>
<p>I was asked today why I often use magic numbers in my code.</p>
<p>It's a small issue, but I feel passionately about it as the current trend of replacing every constant by a symbolic name is extremely annoying. And insistence of some code analysis tools on treating all magic numbers as coding style errors drives me crazy.</p>
<p>Just the give you the context, here's an example of magic number:</p>
<div class="code">
<pre>
<code>i = i + 4;</code>
</pre></div>
<p>And here's a &quot;fixed&quot; version of the code:</p>
<div class="code">
<pre>
<code>#define FOO 4
...
i = i + FOO;</code>
</pre></div>
<p>There are certainly cases where using symbolic names is good style. Two of them come immediately to mind:</p>
<p>First, the case where numeric value of the constant is irrelevant. The number is just a placeholder for a symbolic name:</p>
<div class="code">
<pre>
<code>#define STATE_START 1
#define STATE_ACTIVE 2
#define STATE_SHUTTING_DOWN 3
#define STATE_DONE 4</code>
</pre></div>
<p>This is basically the use case for C enums or Ruby symbols (&quot;:foo&quot; and such).</p>
<p>Second, the case where constant is used as a compile-time configuration parameter:</p>
<div class="code">
<pre>
<code>#define BUFFER_SIZE 4096</code>
</pre></div>
<p>The idea here is to define the value at a single point and then use the symbolic name elsewhere. That way, if need arises, we can change the value as needed by modifying a single line of code.</p>
<p>All that being said, what about other use cases? Cosider this code (you often encounter that kind of thing when parsing network protocols):</p>
<div class="code">
<pre>
<code>uint8_t version = *((uint8_t*) ptr);
ptr += 1;
uint32_t seq = *((uint32_t*) ptr);
ptr += 4;
uint16_t id = *((uint16_t*) ptr);
ptr += 2;</code>
</pre></div>
<p>What about magic numbers beaing added to 'ptr' in the example? Should we rewrite it in the following way?</p>
<div class="code">
<pre>
<code>#define VERSION_SIZE 1
#define SEQ_SIZE 4
#define ID_SIZE 2
...
uint8_t version = *((uint8_t*) ptr);
ptr += VERSION_SIZE;
uint32_t seq = *((uint32_t*) ptr);
ptr += SEQ_SIZE;
uint16_t id = *((uint16_t*) ptr);
ptr += ID_SIZE;</code>
</pre></div>
<p>Does that make sense? Let's think about it.</p>
<p>Does it make the code more readable? Well, no. It actually makes it less readable. If you see a line like this:</p>
<div class="code">
<pre>
<code>ptr += SEQ_SIZE;</code>
</pre></div>
<p>You have to find the definition of SEQ_SIZE at the different place in the file or even in a different file. Thus, smooth reading of the source code is interrupted by scrolling up and down, by grepping and so on.</p>
<p>So maybe the use of the symbolic constant makes the code more maintainable? Maybe you can adjust the behaviour of the program by simply changing a single line of code? Well, no.</p>
<p>This change:</p>
<div class="code">
<pre>
<code>#define SEQ_SIZE 3</code>
</pre></div>
<p>doesn't produce a modified program. It produces a broken program.</p>
<p>The value of SEQ_SIZE is tightly bound to the program logic (namely to the fact that the field in question is of type uint32_t) and cannot be changed at will.</p>
<p>You can still get rid of the magic number like this:</p>
<div class="code">
<pre>
<code>ptr += sizeof (uint32_t);</code>
</pre></div>
<p>But I would argue that it makes the code less readable when compared to simply using number &quot;4&quot; and I am not even speaking of extra effort you need to spend when typing the code.</p>
<p>As a conclusion: Don't treat magic numbers as bad coding style automatically. In some cases replacing magic numbers by symbolic constants makes the code pretty awful to read and maintain.</p>
<p><strong>Martin SÃºstrik, November 27th, 2014</strong></p>
<div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:42">Are you a programmer-mathematician or a programmer-handyman?</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:44">Bullshit jobs</a></p>
</div>
    
    
    
    </div>
<div style="height:2em"></div>
<div class="comments-box">
		
	<div class="options" id="comments-options-hidden" style="display: none">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.showComments(event)">Show Comments</a> 
	</div>
		
	<div id="thread-container" class="thread-container" style="margin-top: 1em">
					


<script type="text/javascript">
	WIKIDOT.forumThreadId = 1057034;
</script>


	<div class="options" id="comments-options-shown">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.hideComments(event)" class="btn btn-default btn-small btn-sm">Hide All Comments</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.unfoldAll(event)" class="btn btn-default btn-small btn-sm">Unfold All</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.foldAll(event)" class="btn btn-default btn-small btn-sm">Fold All</a>
	</div>

<div id="thread-container-posts" style="display: none">
    



	
					
      
    <div class="post-container" id="fpc-2167213">
                      
		<div class="post" id="post-2167213">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2167213)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2167213">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=38d2521ec9092c9b8243b7a0bc9bbe50&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Pierre Chapuis (guest)</span> <span class="odate time_1417074431 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">27 Nov 2014 07:47</span>
														</div>
			</div>
			<div class="content" id="post-content-2167213">
									

<p>This code that reads from &#8216;ptr` is probably already broken anyway, except if the initial address is 3 mod 4 (maybe even 7 mod 8). This kind of unaligned reads works on x86 but probably won&#8217;t on some ARM-based platforms such as Android, causing a SIGBUS.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2167213)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2167213)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2167213" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2167213)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2167213)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=38d2521ec9092c9b8243b7a0bc9bbe50&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Pierre Chapuis (guest)</span>, <span class="odate time_1417074431 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">27 Nov 2014 07:47</span>
		</div>
	</div>
 
                
                	


        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2167219">
                      
		<div class="post" id="post-2167219">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2167219)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2167219">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263540" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1417075002 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">27 Nov 2014 07:56</span>
														</div>
			</div>
			<div class="content" id="post-content-2167219">
									

<p>Yes, same thing for SPARC and other RISC platforms. However, doing it in a portable way would just make the article less clear.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2167219)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2167219)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2167219" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2167219)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2167219)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263540" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1417075002 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">27 Nov 2014 07:56</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2167818">
                      
		<div class="post" id="post-2167818">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2167818)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2167818">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=0de1f64c85de266c1e9cd66e3ceda133&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Maciej Sobczak (guest)</span> <span class="odate time_1417164985 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 08:56</span>
														</div>
			</div>
			<div class="content" id="post-content-2167818">
									

<p>Your network protocol example is not convincing. In fact, it is just broken as it relies on pointer conversions between unrelated types. This kind of code would not pass any safety audit, but even if you don't plan for verification, using such crappy code to justify that magic numbers are good for readability is just nonsense. If you start with crap, you will end up with crappy conclusions.<br />
Now, try rewrite your network protocol parser with some real, well&#8230; parsing. You know, by consuming bytes and using them to compute higher-level values. Use some real coding standard as a guideline (MISRA-C, perhaps?) and then you will discover that you don't need any magic numbers to keep it floating. And, as a side-effect, you might even end up with code that can defend itself at safety reviews.<br />
(And no, it will not be any slower. Pointer conversions between single bytes and words don't buy any performance over properly indexed buffer iteration.)</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2167818)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2167818)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2167818" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2167818)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2167818)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=0de1f64c85de266c1e9cd66e3ceda133&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Maciej Sobczak (guest)</span>, <span class="odate time_1417164985 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 08:56</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2167824">
                      
		<div class="post" id="post-2167824">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2167824)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2167824">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263540" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1417165794 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 09:09</span>
														</div>
			</div>
			<div class="content" id="post-content-2167824">
									

<p>Well, this is the experience from parsing 3GPP protocols: They are so irregular that whatever abstraction you use (uint16_t state = read_short (stream); or whatever) you eventually end up looking directly at the undelying buffer and messing with individual bytes.</p>
<p>Also, even if the above was not true, the problem is just shifted to the parsing tool. It has to extract 2 bytes from the buffer. Should it use a symbolic name or constant 2? Another option, as mentioned in the article, is sizeof(uint16_t) which is just a fancy a somehow less readable way of writing constant 2.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2167824)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2167824)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2167824" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2167824)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2167824)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263540" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1417165794 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 09:09</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2167838">
                      
		<div class="post" id="post-2167838">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2167838)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2167838">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=0de1f64c85de266c1e9cd66e3ceda133&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Maciej Sobczak (guest)</span> <span class="odate time_1417168480 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 09:54</span>
														</div>
			</div>
			<div class="content" id="post-content-2167838">
									

<p>Do you need to extract half-word (two bytes) from the buffer? Try this:</p>
<p>const uint8_t lsb = buffer[current_position++];<br />
const uint8_t msb = buffer[current_position++];</p>
<p>const uint16_t value = ((uint16_t)msb &#171; 8) | (uint16_t)lsb;</p>
<p>I leave it up to you to decide whether magic number 8 deserves to be named, but certainly there is no need to mess with number 2 - it is implicit in code as a natural consequence of *parsing* two consecutive bytes. Obviously, if you parse two bytes, then you are two bytes further down the stream, aren't you? Note also that if you change the protocol to read full word (4 bytes) instead, there is no need to mess with that number or with sizeof(T). But what is most important, endiannes is covered by means of proper computation, so the code will work correctly no matter what is the CPU architecture, without any preprocessor conditional shit. Certainly this is more robust and more portable.<br />
And as a bonus there are no pointer conversions between unrelated types, it's is all just, well&#8230; parsing.</p>
<p>If you want to see a complete non-trivial serializer/deserializer written this way, see here:</p>
<p><a href="http://www.inspirel.com/yami4/misra.html">http://www.inspirel.com/yami4/misra.html</a></p>
<p>In any case, I recommend a good and established coding standard before doing such work. Low-level programming does not have to mean crappy programming.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2167838)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2167838)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2167838" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2167838)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2167838)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=0de1f64c85de266c1e9cd66e3ceda133&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Maciej Sobczak (guest)</span>, <span class="odate time_1417168480 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 09:54</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2167858">
                      
		<div class="post" id="post-2167858">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2167858)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2167858">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263540" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1417170494 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 10:28</span>
														</div>
			</div>
			<div class="content" id="post-content-2167858">
									

<blockquote>
<p>Obviously, if you parse two bytes, then you are two bytes further down the stream, aren't you?</p>
</blockquote>
<p>Yes, but try reading muliple such fields, then try to pad the whole thing to 4-byte boundary. Oops, suddenly you need to know how many bytes were written up to now. The stream abstraction is suddenly broken.</p>
<p>Anyway, the whole parser discussion is irrelevant. We are dealing with computers and computers deal with numbers. At some point down the stack you just have to start using numbers (e.g. number 8 in your example). So, when reaching that point, what are you going to do? Use literals, symbolic names or what?</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2167858)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2167858)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2167858" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2167858)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2167858)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263540" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1417170494 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 10:28</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2167861">
                      
		<div class="post" id="post-2167861">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2167861)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2167861">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=0de1f64c85de266c1e9cd66e3ceda133&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Maciej Sobczak (guest)</span> <span class="odate time_1417170883 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 10:34</span>
														</div>
			</div>
			<div class="content" id="post-content-2167861">
									

<p>That will depend on the number itself. Some of them are self-descriptive or are heavily coupled to foundational concepts, like 0, 1, 8 (num of bits in a byte), but some are not (2, 100, 1000, etc.). I tend to use literal values for the former and named values for the latter group.</p>
<p>In both cases the idea is that the reader should have no additional questions when reading the code and the meaning of each number (whether named or not) should be clear from the place where it is used.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2167861)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2167861)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2167861" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2167861)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2167861)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=0de1f64c85de266c1e9cd66e3ceda133&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Maciej Sobczak (guest)</span>, <span class="odate time_1417170883 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">28 Nov 2014 10:34</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2193781">
                      
		<div class="post" id="post-2193781">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2193781)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2193781">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=425335501fb9737d82892e11669b05b7&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>ovmjm (guest)</span> <span class="odate time_1420185932 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">02 Jan 2015 08:05</span>
														</div>
			</div>
			<div class="content" id="post-content-2193781">
									

<p>Different language, same conclusions :<br />
<a href="http://wiki.laptop.org/go/Forth_Lesson_6">http://wiki.laptop.org/go/Forth_Lesson_6</a> (see Stylistic Point - Too Many Constants)</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2193781)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2193781)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2193781" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2193781)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2193781)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=425335501fb9737d82892e11669b05b7&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>ovmjm (guest)</span>, <span class="odate time_1420185932 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">02 Jan 2015 08:05</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2232068">
                      
		<div class="post" id="post-2232068">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2232068)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2232068">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=fbc72e6343897b80b1a58a86012dd871&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>citizenfour (guest)</span> <span class="odate time_1423850925 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">13 Feb 2015 18:08</span>
														</div>
			</div>
			<div class="content" id="post-content-2232068">
									

<p>much safer version is:</p>
<p>static_assert(sizeof (seq) == SEQ_SIZE);<br />
ptr += sizeof (seq);</p>
<p>also auto and decltype are your good friends.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2232068)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2232068)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2232068" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2232068)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2232068)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=fbc72e6343897b80b1a58a86012dd871&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>citizenfour (guest)</span>, <span class="odate time_1423850925 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">13 Feb 2015 18:08</span>
		</div>
	</div>
 
                
        
            </div>
 



</div>

        <a href="javascript:;" id="new-post-button" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.newPost(event,null)"
      style="display:  none ; margin-bottom:1em"
    >Add a New Comment</a>


    <div id="new-post-form-container">
        <div id="new-post-preview-div" style="display: none">
            <h1>Post preview:</h1>
            <div class="post-container"></div>
            <div></div>
            <a href="javascript:;" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.closePreview(event)" class="btn btn-danger">Close preview</a>
        </div>

        <div id="new-post-div" class="well">
            <form id="new-post-form" onkeypress="return OZONE.utils.disableEnterKey(event)">
                <input type="hidden" name="threadId" value="1057034"/>
                <input type="hidden" name="parentId" value=""/>
                                    <table class="guest-commenting">
                        <tr>
                            <td><input class="text form-control" name="guestName" type="text" maxlength="30" value="" title="Name"/></td>
                            <td>or <a href="#action:login">Sign in as Wikidot user</a></td>
                        </tr>
                        <tr>
                            <td><input class="text form-control" name="guestEmail" type="text" maxlength="50" value="" title="E-mail address"/></td>
                            <td>(will not be published)</td>
                        </tr>
                    </table>
                                <div><textarea id="np-text" name="source" rows="10" cols="50" class="form-control"></textarea></div>
                <div class="change-textarea-size">
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',-5)">-</a>
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',5)">+</a>
                </div>
                <div class="edit-help-34">
                    Help: <a href="http://www.wikidot.com/doc:quick-reference" target="_blank">wiki text quick reference</a>                </div>
                                
                <div id="edit-post-captcha"></div>
                
                <div class="buttons alignleft">
                    <input class="btn btn-danger btn-small btn-sm" type="button" value="Cancel" id="np-cancel" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.cancel(event)"/>
                    <input class="btn btn-default btn-small btn-sm" type="button" value="Preview" id="np-preview" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.preview(event)"/>
                    <input class="btn btn-primary btn-small btn-sm" type="button" value="Post it" id="np-post" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.save(event)"/>
                </div>
                    
            </form>
        </div>	

    </div> 
            <script type="text/javascript">
            
            $j(function() {
                WIKIDOT.Editor.init("np-text", "np-editor-panel");
            });
            
        </script>
    
 

<div style="display:none" id="post-options-template">
	<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showPermalink(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Permanent Link</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.editPost(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Edit</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.deletePost(event,'%POST_ID%')" class="btn btn-danger btn-small btn-sm">Delete</a>
</div>
	
			</div>
	
	
	
</div></div>

                    </div>

                    


                    



                    

                    <div id="page-info-break"></div>
                    
                        <div id="page-options-container">
                            
                        </div>
                    
                    <div id="action-area" style="display: none;"></div>
                </div>
            </div>
            
            
            
            <div id="footer" style="display: block; visibility: visible;">
                <div class="options" style="display: block; visibility: visible;">
    <a href="http://www.wikidot.com/doc" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:terms-of-service" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:privacy-policy" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="http://www.wikidot.com">Wikidot.com</a> 
            </div>
            
                <div id="license-area" class="license-area">
                    Unless otherwise stated, the content of this page is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 License</a>
                </div>
            
            
            



            <div id="extrac-div-1"><span></span></div><div id="extrac-div-2"><span></span></div><div id="extrac-div-3"><span></span></div>
            
            
            
            
                
            
        </div>
        
    </div>
<!-- These extra divs/spans may be used as catch-alls to add extra imagery. -->
<div id="extra-div-1"><span></span></div><div id="extra-div-2"><span></span></div><div id="extra-div-3"><span></span></div>
<div id="extra-div-4"><span></span></div><div id="extra-div-5"><span></span></div><div id="extra-div-6"><span></span></div>
</div>




</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- Quantcast -->
    <script type="text/javascript">
    _qoptions={
        qacct:"p-edL3gsnUjJzw-"
    };
    (function() {
        var qc = document.createElement('script'); qc.type = 'text/javascript'; qc.async = true;
        qc.src = ('https:' == document.location.protocol ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(qc, s);
    })();
    </script>
    <noscript>
        <img src="http://pixel.quantserve.com/pixel/p-edL3gsnUjJzw-.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
    </noscript>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>
</html>