<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Footnotes to &quot;Select Statement Considered Harmful&quot; - 250bpm</title>
    
    	<script type="text/javascript" src="http://www.wikidot.com/default__flow/login__CustomDomainScript?site_id=148706"></script>

    
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = 'http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "250bpm.com";
        WIKIREQUEST.info.siteId = 148706;
        WIKIREQUEST.info.siteUnixName = "250bpm";
        WIKIREQUEST.info.categoryId = 2550760;
        WIKIREQUEST.info.themeId = 18520;
        WIKIREQUEST.info.requestPageName = "blog:73";
        OZONE.request.timestamp = 1594263558;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "blog:73";
        WIKIREQUEST.info.pageId = 36799090;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/WIKIDOT.combined.js"></script>
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
        
                
        /* theme */
                    @import url(http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--theme/base/css/style.css);
                    @import url(http://250bpm.wdfiles.com/local--theme/250bpm/style.css);
            </style>
    
        
        
        
    <link rel="shortcut icon" href="/local--favicon/favicon.gif"/>
    <link rel="icon" type="image/gif" href="/local--favicon/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="/common--images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/common--images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/common--images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-3207370-9']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
        <link rel="manifest" href="/onesignal/manifest.json" />
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" acync=""></script>
    <script>
        var OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
          OneSignal.init({
            appId: null,
          });
        });
    </script>
        
<link rel="alternate" type="application/rss+xml" title="Comments for the page &quot;Footnotes to &quot;Select Statement Considered Harmful&quot;&quot;" href="/feed/page/comments-36799090.xml"/><script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumCommentsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadPostsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/sub/ForumNewPostFormModule.js"></script>
</head>
<body id="html-body">
<div id="skrollr-body">
<a name="page-top"></a>





<div id="container-wrap-wrap">
    <div id="container-wrap">
        <div id="container">
            <div id="header">
              <h1><a href="/"><span>250bpm</span></a></h1>
                
                
                <!-- google_ad_section_start(weight=ignore) -->
                
                <div id="search-top-box" class="form-search">
    <form id="search-top-box-form" action="dummy" class="input-append">
        <input id="search-top-box-input" class="text empty search-query" type="text" size="15" name="query" value="Search this site" onfocus="if(YAHOO.util.Dom.hasClass(this, 'empty')){YAHOO.util.Dom.removeClass(this,'empty'); this.value='';}"/><input class="button btn" type="submit" name="search" value="Search"/>
    </form>
</div>
                
                
                    <div id="top-bar">
                        

<ul>
<li><a href="/">Home</a></li>
<li><a href="https://github.com/sustrik/cartesian">Cartesian</a></li>
<li><a href="http://libdill.org">Libdill</a></li>
<li><a href="http://nanomsg.org">Nanomsg</a></li>
<li><a href="https://github.com/sustrik/tiles">Tiles</a></li>
<li><a href="http://zero.mq">ZeroMQ</a></li>
<li><a href="/contact">Contact</a></li>
</ul>

                    </div>
                
                <div id="login-status"><a href="javascript:;" onclick="WIKIDOT.page.listeners.createAccount(event)" class="login-status-create-account btn">Create account</a> <span>or</span> <a href="javascript:;" onclick="WIKIDOT.page.listeners.loginClick(event)" class="login-status-sign-in btn btn-primary">Sign in</a> </div>
                <div id="header-extra-div-1"><span></span></div><div id="header-extra-div-2"><span></span></div><div id="header-extra-div-3"><span></span></div>
            </div>
            
            <div id="content-wrap">
                
                    <div id="side-bar">
                        


                        


                        


                    </div>
                
                
                <!-- google_ad_section_end -->
                
                <div id="main-content">
                    <div id="action-area-top"></div>
                    
                    
                        <div id="page-title">
                            Footnotes to &quot;Select Statement Considered Harmful&quot;
                        </div>
                    

                    

                    



                    <div id="page-content">
                        

<div style="width:50em"><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:72">Select Statement Considered Harmful</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:74">The Adventures of Boltzmann Brain (part I)</a></p>
</div>
    
    
    
    </div>
<p>I believe that <a href="http://250bpm.com/blog:72">&quot;select considered harmful&quot;</a> article is best piece of writing about software design I have ever done. However, I feel it's kind of hard to grasp.</p>
<p>On one hand, the idea looks suspiciously simple, like something one could have thought of over breakfast and then spent 15 minutes writing it down. In other words, something not worth of paying too much attention to. Whereas, in fact, it's the culmination of a decade of implementing and thinking about distributed systems.</p>
<p>On the other hand, lot of people haven't yet fully internalised Go's model of lightweight processes communicating via channels. Inviting them to go one step further and imagine a world where all the inter-process flow control is done via channels, without a need for the crutch that is select statement, is maybe asking for too much, too early.</p>
<p>Finally, I've tried to keep the essay as succinct and simple as possible. I've deliberately omitted all the comments and footnotes that may have otherwise helped with intuitive understanding of the issue.</p>
<p>Let me thus write down a couple of footnotes that may help with understanding the thinking behind the essay.</p>
<h2 id="toc0"><span>Scheduling should be done by the system</span></h2>
<p>At certain level of the system stack we kind of expect not to do scheduling by hand. This may not be the case for assembly language and sometimes not even for C (it's a system language after all) but everywhere above that level the problem of scheduling should be transparently solved either by the operating system or by the language runtime.</p>
<p>Except that it's often not. The most visible case is writing networks servers in C where launching a process/thread per TCP connection is too expensive to be an option and programmer thus has to do all the switching between contexts of different TCP connections by hand.</p>
<p>However, the phenomenon it much more common. You may not have though of it that way, but every time you were doing shared-state concurrency (mutexes, semaphores et c.) you were actually writing an implicit scheduler meant to coordinate all the threads in your program.</p>
<p>Every time you have written an event loop you were facing the same problem: It was really a simple scheduler, wasn't it?</p>
<p>All of these things cause huge amount of pain. And I am not speaking of minor inconveniences here. What I mean is that every single programmer must have wasted significant portion of their working life, oftentimes entire man-years, implementing 100 different variations of do-it-yourself scheduling. Plus debugging it when the scheduler &#8212; as one would expect &#8212; went awry.</p>
<p>I am a big fan of Go language (although I haven't used it much) because, unlike many other languages, it actually tries hard to solve this grave problem. Goroutines are lightweight enough to be used every time a simple asynchronous task has to be done. Yay! No more hand-crafted scheduling between concurrent TCP connections! Channels, on the other hand, make it possible to do without mutexes, condition variables, semaphores and such. Farewell, scheduling access to the shared state! I won't miss you.</p>
<p>All that being said, select{} statement seems to be focused on providing manual scheduling capabilities to the user.</p>
<p>Let me explain.</p>
<p>Imagine the case where you have multiple worker goroutines, all sending messages to the main routine. They can do so via a single channel. To make the point more obvious, let's make the channel unbuffered:</p>
<div class="image-container aligncenter"><a href="http://250bpm.wdfiles.com/local--files/blog:73/footnote1.jpeg"><img src="http://250bpm.wdfiles.com/local--resized-images/blog:73/footnote1.jpeg/medium.jpg" alt="footnote1.jpeg" class="image" /></a></div>
<p>When happens when main routine reads a message from the channel? What looks like a pretty standard I/O operation is in fact translated by the language runtime into a scheduling decision: The channel picks one of the ready worker goroutines and unblocks it. Nice. The scheduling is almost invisible to the user.</p>
<p>Let's consider a different way of implementing the same thing though. Let us have one channel per worker goroutine. Main goroutine will then select{} on those channels to get the messages. In theory, it works the same as the original one channel design. Channels use simple probabilistic scheduler. So does select. The behaviour should therefore be identical:</p>
<div class="image-container aligncenter"><a href="http://250bpm.wdfiles.com/local--files/blog:73/footnote2.jpeg"><img src="http://250bpm.wdfiles.com/local--resized-images/blog:73/footnote2.jpeg/medium.jpg" alt="footnote2.jpeg" class="image" /></a></div>
<p>The difference though is that in the latter case the user is free to manipulate the set of channels to wait for manually and can thus plug into the system scheduler. For example, they can select{} on high-priority channels first and only if no message is available fall back to selecting on all channels, including low-priority ones.</p>
<p>In short, if we use channel, scheduling is done by the system. If we use select{} scheduling may (or may not!) be done by the user.</p>
<p>Having the statement in the language actually makes sense for the same reason it makes sense to have goto in C: At the end of the day, there will still be a small contingent of programmers who do want to do scheduling by hand.</p>
<p>But be aware! Having the statement in the language doesn't mean it's a necessarily good idea to use it. Think of the goto!</p>
<p>A final question is somewhat tangential but interesting nonetheless: Given that Go is supposed to do scheduling for the user, are the scheduling algorithms versatile enough to satisfy all the users?</p>
<p>The answer is almost certainly negative. There are no goroutine priorities, nor prioritised channels. There are no fancy real-time schedulers. Nothing of the sort. However, the scheduling that is available out of the box is sufficient in 99% of cases. If you are unlucky enough to need something more sophisticated, here's your select statement. Go and use it.</p>
<h2 id="toc1"><span>Channels vs. Functions</span></h2>
<p>In the original essay I've asserted that using select statement leads to ugly code. While that may sound controversial, rephrasing it as &quot;scheduling by hand makes the code ugly&quot; is unlikely to be challenged by anyone.</p>
<p>However, there are aspects of the problem that are not directly related to scheduling but still contribute to the ugliness of the code.</p>
<p>Imagine an object. It has some functions, some properties and so on. It also contains a running goroutine. The goroutine does useful work based on commands sent to it via a channel. We would like to hide the implementation of the object behing a nice API and so we create some new functions to steer the goroutine. For example, forbnicate() function will create a 'frobnicate' command and send it to the channel. Nice, isn't it?</p>
<p>Except that it doesn't play well with select{}. If the user is doing their own scheduling, they may want to try to frobnicate three different instances of the object in parallel like this:</p>
<div class="code">
<pre>
<code>for {
    select {
    case channelToInstance1 &lt;- frobnicate:
    case channelToInstance2 &lt;- frobnicate:
    case channelToInstance3 &lt;- frobnicate:
    }
}</code>
</pre></div>
<p>No such thing is possible using frobnicate() function. If all you have is the function you can frobnicate at most one instance at a time. No luck.</p>
<p>What that means is that if select{} is expected to be used, we won't have nice object APIs. The channels will dangle out of the open gut of the object making attempts to hide internals of the object behind nice function-based API futile. Object will expose both channels and functions. Each will have its own parameter syntax, its own invocation syntax and so on. Unlike functions, channels don't even allow to specify output parameters. It's ugly:</p>
<div class="image-container aligncenter"><a href="http://250bpm.wdfiles.com/local--files/blog:73/footnote3.jpeg"><img src="http://250bpm.wdfiles.com/local--resized-images/blog:73/footnote3.jpeg/medium.jpg" alt="footnote3.jpeg" class="image" /></a></div>
<p>However, if we get rid of select, the encapsulation suddenly starts working. Sending a message to channel can be hidden inside a function. If there's a reply, the sequence of sending a request through one channel and getting a reply through a different one can be hidden inside a function.</p>
<div class="image-container aligncenter"><a href="http://250bpm.wdfiles.com/local--files/blog:73/footnote4.jpeg"><img src="http://250bpm.wdfiles.com/local--resized-images/blog:73/footnote4.jpeg/medium.jpg" alt="footnote4.jpeg" class="image" /></a></div>
<p>There's certainly more to be said in favour of select-free programming, but these two footnotes should give you at least a starting point for thinking about the problem.</p>
<p><strong>Martin SÃºstrik, February 23rd, 2016</strong></p>
<div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:72">Select Statement Considered Harmful</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:74">The Adventures of Boltzmann Brain (part I)</a></p>
</div>
    
    
    
    </div>
<div style="height:2em"></div>
<div class="comments-box">
		
	<div class="options" id="comments-options-hidden" style="display: none">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.showComments(event)">Show Comments</a> 
	</div>
		
	<div id="thread-container" class="thread-container" style="margin-top: 1em">
					


<script type="text/javascript">
	WIKIDOT.forumThreadId = 1612411;
</script>


	<div class="options" id="comments-options-shown">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.hideComments(event)" class="btn btn-default btn-small btn-sm">Hide All Comments</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.unfoldAll(event)" class="btn btn-default btn-small btn-sm">Unfold All</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.foldAll(event)" class="btn btn-default btn-small btn-sm">Fold All</a>
	</div>

<div id="thread-container-posts" style="display: none">
    



	
					
      
    <div class="post-container" id="fpc-2461994">
                      
		<div class="post" id="post-2461994">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2461994)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2461994">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=7196533b5aa2fc52c21517218723b2c4&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Garrett D'Amore (guest)</span> <span class="odate time_1456248133 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 17:22</span>
														</div>
			</div>
			<div class="content" id="post-content-2461994">
									

<p>I find that select is most useful in &quot;internal&quot; bits of implementation, that I don't expose to my external API consumers. In mangos, I use it to handle cases like timeouts, and notifications where the object must wait on some condition before proceeding.</p>
<p>Frankly, I'm not a huge fan of select, and coming as I do from kernel programming, I find condition variables both faster and easier to use in many of the circumstances that I care about. But I would generally not like to expose them to my external consumers either.</p>
<p>That said, a few mangos users have requested that mangos offer select()able API. Its easy to build that on top of mangos, and I've done a proof of concept of it, but I wouldn't want to be preferred &#8212; both for the reasons you list here, but also because the extra level of asynchronous operation adds a measurable amount of latency. (And I live in a very low latency world.)</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2461994)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2461994)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2461994" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2461994)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2461994)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=7196533b5aa2fc52c21517218723b2c4&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Garrett D'Amore (guest)</span>, <span class="odate time_1456248133 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 17:22</span>
		</div>
	</div>
 
                
                	


        
                      
    <div class="post-container" id="fpc-2462042">
                      
		<div class="post" id="post-2462042">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2462042)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2462042">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263558" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1456251193 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 18:13</span>
														</div>
			</div>
			<div class="content" id="post-content-2462042">
									

<p>Yes, agreed. How bad is the latency impact in Go, btw? With coroutines implemented in C it's seems to be close to zero.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2462042)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2462042)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2462042" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2462042)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2462042)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263558" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1456251193 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 18:13</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2462009">
                      
		<div class="post" id="post-2462009">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2462009)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2462009">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/reqshark" onclick="WIKIDOT.page.listeners.userInfo(1848719); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=1848719&amp;amp;size=small&amp;amp;timestamp=1594263558" alt="reqshark" style="background-image:url(http://www.wikidot.com/userkarma.php?u=1848719)"/></a><a href="http://www.wikidot.com/user:info/reqshark" onclick="WIKIDOT.page.listeners.userInfo(1848719); return false;" >reqshark</a></span> <span class="odate time_1456249101 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 17:38</span>
														</div>
			</div>
			<div class="content" id="post-content-2462009">
									

<p>nice ref to memfrob(3) !</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2462009)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2462009)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2462009" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2462009)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2462009)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/reqshark" onclick="WIKIDOT.page.listeners.userInfo(1848719); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=1848719&amp;amp;size=small&amp;amp;timestamp=1594263558" alt="reqshark" style="background-image:url(http://www.wikidot.com/userkarma.php?u=1848719)"/></a><a href="http://www.wikidot.com/user:info/reqshark" onclick="WIKIDOT.page.listeners.userInfo(1848719); return false;" >reqshark</a></span>, <span class="odate time_1456249101 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">23 Feb 2016 17:38</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2469762">
                      
		<div class="post" id="post-2469762">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2469762)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2469762">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=9657ce7cb5f23f7780c1c9a7e49c6af4&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Christopher Penrose (guest)</span> <span class="odate time_1457484613 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">09 Mar 2016 00:50</span>
														</div>
			</div>
			<div class="content" id="post-content-2469762">
									

<p>Native server implementations have shunned select() for some time. epoll() and kqueue() are typically used instead due to their scalability. For example, UDT is implemented on Linux utilizing epoll().</p>
<p>I am very new to the concurrency model presented by Go, and I have only developed using a Go descendent, Clojure's core.async. Though my impression is naive and evolving, I have yet to find the channel model to be sufficiently general for many specialized concurrency applications. While I enjoy functional Clojure development, and find the language to be immensely expressive, I find core.async to be unusually limiting in contrast. I ascribe these limits mostly to its Go inheritance, but Clojure's STM does also play here. But I should be fair to Go and understand it more directly. Still, I imagine that it would be particularly limiting to use the channel model for interoperability with native multi-threaded APIs. Imagine trying to wrangle an SMB implementation using channels. My point being, that the model that Go presents is perhaps young and quite radical &#8212; it suggests an entirely different kind of systems programming. The model currently has a narrow strong suit for encapsulated server development that which does not interface with other code that have their own concurrency models. But admittedly that niche does include much of what backends accomplish today.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2469762)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2469762)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2469762" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2469762)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2469762)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=9657ce7cb5f23f7780c1c9a7e49c6af4&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Christopher Penrose (guest)</span>, <span class="odate time_1457484613 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">09 Mar 2016 00:50</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2470439">
                      
		<div class="post" id="post-2470439">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2470439)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2470439">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=72f04c23021f35486da80c0c2048e7b2&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>The M (guest)</span> <span class="odate time_1457595133 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">10 Mar 2016 07:32</span>
														</div>
			</div>
			<div class="content" id="post-content-2470439">
									

<p>I just wanted to say that I really enjoy reading your posts.<br />
These topics are also central to my interests. I just want to share some of<br />
my thoughts.</p>
<p>I've developed linux-based servers in the past and currently I'm working in the more low level<br />
embedded systems domain. The main problem I'm constantly facing is managing concurrency.<br />
The difficulties stem in my opinion from the fact that, looking from the historical point of view,<br />
the main research area was always transformational systems. Nowadays the balance is moved towards<br />
interactive and reactive systems. It always seem strange to me that the ligthweight concurrency support<br />
already exists in the 'kernel-space', but programmers developing 'user-space' applications must invent<br />
their own solutions in order to meet the performance requirements.</p>
<p>The process/thread approach is well suited to partitioning the work into independent parts<br />
like it is the case in traditional time-sharing. A thread is, in most languages, already a simple state machines.<br />
For example Java: <a href="http://www.w3resource.com/java-tutorial/java-threadclass-methods-and-threadstates.php">http://www.w3resource.com/java-tutorial/java-threadclass-methods-and-threadstates.php</a><br />
Shared-state concurrency tries to implicitly reshape this basic state machine. Look for example at the classic<br />
Dining Philosophers Problem (DPD). The standard solution is to model the philosophers as independent tasks<br />
with the shared resource access implemented implicitly using locks. Hundreds of papers were dedicated to<br />
analysing all the pitfalls that one could make using this approach. By implementing the scheduler as a separate,<br />
explicit entity, all the concurrency hazards are eliminated (<a href="http://www.state-machine.com/doc/AN_DPP.pdf">http://www.state-machine.com/doc/AN_DPP.pdf</a>).<br />
Here is my question: is it possible to eliminate the state machine entirely in this example using your approach?</p>
<p>I don't think that it's always possible to eliminate the state machine and we should focus on<br />
making the cooperation points explicit and keeping the tight intertwining<br />
between purely computational and IO domains from becoming overly complex and, in turn, unmanageable.<br />
I was looking at the Haskell way of dealing with these issues - monads,<br />
specifically the IO Monad. It seems that in this approach the two intertwined trees can be separated, replaced and<br />
transformed easily. It is possible for example to test the system in only purely computational environment or generate<br />
code in other language than Haskell - <a href="https://github.com/tomahawkins/atom">https://github.com/tomahawkins/atom</a>. This approach also addresses the composability issue<br />
you mentioned.</p>
<p>Here's also an interesting article: <a href="https://glyph.twistedmatrix.com/2014/02/unyielding.html">https://glyph.twistedmatrix.com/2014/02/unyielding.html</a></p>
<p>Again, I really enjoy your writings and appreciate the knowledge you provide.</p>
<p>Best regards,<br />
Mariusz</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2470439)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2470439)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2470439" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2470439)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2470439)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=72f04c23021f35486da80c0c2048e7b2&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>The M (guest)</span>, <span class="odate time_1457595133 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">10 Mar 2016 07:32</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2471324">
                      
		<div class="post" id="post-2471324">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2471324)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2471324">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=ccbe7da9a44a8737ca2eda4462c42fe1&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Martin Sustrik (guest)</span> <span class="odate time_1457749839 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">12 Mar 2016 02:30</span>
														</div>
			</div>
			<div class="content" id="post-content-2471324">
									

<p>We may be speaking of different things, really. What you mean by &quot;state machine&quot; AFAIU is the mechanism to deal with input that's not full available upfront. In that sense, every stack frame is a simple state machine. There's no coding without state machines in that sense.</p>
<p>What I meant was rather more limited: An explicit piece of code where you save your state, switch to a different task to get back to the original task later on.</p>
<p>My argument was that this kind of thing never has to be done by the user. It can by handled transparently by language runtime and/or OS.</p>
<p>I enjoyed the article you've linked to (<a href="https://glyph.twistedmatrix.com/2014/02/unyielding.html">https://glyph.twistedmatrix.com/2014/02/unyielding.html</a>), if for nothing else then because the author comes from exactly the opposite the direction that I do. I was burned by explicit context switching. They were, so it seems, burned by the implicit one.</p>
<p>Still, one example to keep in mind while reading the article is OS-based preemptive multitasking. Surely, nobody wants to get back to MS-DOS days with a single program running on a machine. Yet, the switching is comletely implicit. And given that there's good process isolation, nobody really complains about it.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2471324)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2471324)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2471324" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2471324)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2471324)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=ccbe7da9a44a8737ca2eda4462c42fe1&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Martin Sustrik (guest)</span>, <span class="odate time_1457749839 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">12 Mar 2016 02:30</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2471972">
                      
		<div class="post" id="post-2471972">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2471972)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2471972">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=72f04c23021f35486da80c0c2048e7b2&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>The M (guest)</span> <span class="odate time_1457865414 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">13 Mar 2016 10:36</span>
														</div>
			</div>
			<div class="content" id="post-content-2471972">
									

<p>I'm little confused right now&#8230; Your problems with shared state concurrency using mutexes/semaphores were not connected to non-deterministic behaviours they cause to be observed while combined with implicit context switching? That is exactly the thing which everybody seems to complain about. The main advantage of Hoare's CSP (channels+coroutines) vs. shared state concurrency is believed to be exactly this property - introduce partial order and make the non-determinism non-observable. It doesn't really matter if there is implicit context switching as long it does not make the mutable state evolve in different ways.<br />
You are right that parallelizing work into independent task can be handled transparently. The problem is that real-life task are seldomly truly independent. There is a part that can be parallelized but some of the work must be serialized (the reduce part in MapReduce). The second part is the problematic one.</p>
<p>Best regards,<br />
Mariusz</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2471972)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2471972)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2471972" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2471972)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2471972)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=72f04c23021f35486da80c0c2048e7b2&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>The M (guest)</span>, <span class="odate time_1457865414 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">13 Mar 2016 10:36</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
            </div>
 



</div>

        <a href="javascript:;" id="new-post-button" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.newPost(event,null)"
      style="display:  none ; margin-bottom:1em"
    >Add a New Comment</a>


    <div id="new-post-form-container">
        <div id="new-post-preview-div" style="display: none">
            <h1>Post preview:</h1>
            <div class="post-container"></div>
            <div></div>
            <a href="javascript:;" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.closePreview(event)" class="btn btn-danger">Close preview</a>
        </div>

        <div id="new-post-div" class="well">
            <form id="new-post-form" onkeypress="return OZONE.utils.disableEnterKey(event)">
                <input type="hidden" name="threadId" value="1612411"/>
                <input type="hidden" name="parentId" value=""/>
                                    <table class="guest-commenting">
                        <tr>
                            <td><input class="text form-control" name="guestName" type="text" maxlength="30" value="" title="Name"/></td>
                            <td>or <a href="#action:login">Sign in as Wikidot user</a></td>
                        </tr>
                        <tr>
                            <td><input class="text form-control" name="guestEmail" type="text" maxlength="50" value="" title="E-mail address"/></td>
                            <td>(will not be published)</td>
                        </tr>
                    </table>
                                <div><textarea id="np-text" name="source" rows="10" cols="50" class="form-control"></textarea></div>
                <div class="change-textarea-size">
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',-5)">-</a>
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',5)">+</a>
                </div>
                <div class="edit-help-34">
                    Help: <a href="http://www.wikidot.com/doc:quick-reference" target="_blank">wiki text quick reference</a>                </div>
                                
                <div id="edit-post-captcha"></div>
                
                <div class="buttons alignleft">
                    <input class="btn btn-danger btn-small btn-sm" type="button" value="Cancel" id="np-cancel" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.cancel(event)"/>
                    <input class="btn btn-default btn-small btn-sm" type="button" value="Preview" id="np-preview" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.preview(event)"/>
                    <input class="btn btn-primary btn-small btn-sm" type="button" value="Post it" id="np-post" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.save(event)"/>
                </div>
                    
            </form>
        </div>	

    </div> 
            <script type="text/javascript">
            
            $j(function() {
                WIKIDOT.Editor.init("np-text", "np-editor-panel");
            });
            
        </script>
    
 

<div style="display:none" id="post-options-template">
	<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showPermalink(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Permanent Link</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.editPost(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Edit</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.deletePost(event,'%POST_ID%')" class="btn btn-danger btn-small btn-sm">Delete</a>
</div>
	
			</div>
	
	
	
</div></div>

                    </div>

                    


                    



                    

                    <div id="page-info-break"></div>
                    
                        <div id="page-options-container">
                            
                        </div>
                    
                    <div id="action-area" style="display: none;"></div>
                </div>
            </div>
            
            
            
            <div id="footer" style="display: block; visibility: visible;">
                <div class="options" style="display: block; visibility: visible;">
    <a href="http://www.wikidot.com/doc" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:terms-of-service" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:privacy-policy" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="http://www.wikidot.com">Wikidot.com</a> 
            </div>
            
                <div id="license-area" class="license-area">
                    Unless otherwise stated, the content of this page is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 License</a>
                </div>
            
            
            



            <div id="extrac-div-1"><span></span></div><div id="extrac-div-2"><span></span></div><div id="extrac-div-3"><span></span></div>
            
            
            
            
                
            
        </div>
        
    </div>
<!-- These extra divs/spans may be used as catch-alls to add extra imagery. -->
<div id="extra-div-1"><span></span></div><div id="extra-div-2"><span></span></div><div id="extra-div-3"><span></span></div>
<div id="extra-div-4"><span></span></div><div id="extra-div-5"><span></span></div><div id="extra-div-6"><span></span></div>
</div>




</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- Quantcast -->
    <script type="text/javascript">
    _qoptions={
        qacct:"p-edL3gsnUjJzw-"
    };
    (function() {
        var qc = document.createElement('script'); qc.type = 'text/javascript'; qc.async = true;
        qc.src = ('https:' == document.location.protocol ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(qc, s);
    })();
    </script>
    <noscript>
        <img src="http://pixel.quantserve.com/pixel/p-edL3gsnUjJzw-.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
    </noscript>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>
</html>