<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>State Machines and the Strange Case of Mutating API - 250bpm</title>
    
    	<script type="text/javascript" src="http://www.wikidot.com/default__flow/login__CustomDomainScript?site_id=148706"></script>

    
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = 'http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "250bpm.com";
        WIKIREQUEST.info.siteId = 148706;
        WIKIREQUEST.info.siteUnixName = "250bpm";
        WIKIREQUEST.info.categoryId = 2550760;
        WIKIREQUEST.info.themeId = 18520;
        WIKIREQUEST.info.requestPageName = "blog:142";
        OZONE.request.timestamp = 1594263597;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "blog:142";
        WIKIREQUEST.info.pageId = 495396783;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/WIKIDOT.combined.js"></script>
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
        
                
        /* theme */
                    @import url(http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--theme/base/css/style.css);
                    @import url(http://250bpm.wdfiles.com/local--theme/250bpm/style.css);
            </style>
    
        
        
        
    <link rel="shortcut icon" href="/local--favicon/favicon.gif"/>
    <link rel="icon" type="image/gif" href="/local--favicon/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="/common--images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/common--images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/common--images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-3207370-9']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
        <link rel="manifest" href="/onesignal/manifest.json" />
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" acync=""></script>
    <script>
        var OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
          OneSignal.init({
            appId: null,
          });
        });
    </script>
        
<link rel="alternate" type="application/rss+xml" title="Comments for the page &quot;State Machines and the Strange Case of Mutating API&quot;" href="/feed/page/comments-495396783.xml"/><script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumCommentsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadPostsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/sub/ForumNewPostFormModule.js"></script>
</head>
<body id="html-body">
<div id="skrollr-body">
<a name="page-top"></a>





<div id="container-wrap-wrap">
    <div id="container-wrap">
        <div id="container">
            <div id="header">
              <h1><a href="/"><span>250bpm</span></a></h1>
                
                
                <!-- google_ad_section_start(weight=ignore) -->
                
                <div id="search-top-box" class="form-search">
    <form id="search-top-box-form" action="dummy" class="input-append">
        <input id="search-top-box-input" class="text empty search-query" type="text" size="15" name="query" value="Search this site" onfocus="if(YAHOO.util.Dom.hasClass(this, 'empty')){YAHOO.util.Dom.removeClass(this,'empty'); this.value='';}"/><input class="button btn" type="submit" name="search" value="Search"/>
    </form>
</div>
                
                
                    <div id="top-bar">
                        

<ul>
<li><a href="/">Home</a></li>
<li><a href="https://github.com/sustrik/cartesian">Cartesian</a></li>
<li><a href="http://libdill.org">Libdill</a></li>
<li><a href="http://nanomsg.org">Nanomsg</a></li>
<li><a href="https://github.com/sustrik/tiles">Tiles</a></li>
<li><a href="http://zero.mq">ZeroMQ</a></li>
<li><a href="/contact">Contact</a></li>
</ul>

                    </div>
                
                <div id="login-status"><a href="javascript:;" onclick="WIKIDOT.page.listeners.createAccount(event)" class="login-status-create-account btn">Create account</a> <span>or</span> <a href="javascript:;" onclick="WIKIDOT.page.listeners.loginClick(event)" class="login-status-sign-in btn btn-primary">Sign in</a> </div>
                <div id="header-extra-div-1"><span></span></div><div id="header-extra-div-2"><span></span></div><div id="header-extra-div-3"><span></span></div>
            </div>
            
            <div id="content-wrap">
                
                    <div id="side-bar">
                        


                        


                        


                    </div>
                
                
                <!-- google_ad_section_end -->
                
                <div id="main-content">
                    <div id="action-area-top"></div>
                    
                    
                        <div id="page-title">
                            State Machines and the Strange Case of Mutating API
                        </div>
                    

                    

                    



                    <div id="page-content">
                        

<div style="width:50em">
<p>State machines are widely used to implement network protocols, or, generally, objects that have to react to external events.</p>
<p>Consider TCP state machine:</p>
<div class="image-container aligncenter"><img src="http://250bpm.wdfiles.com/local--files/blog:25/events3.png" alt="events3.png" class="image" /></div>
<p>During its lifetime TCP socket moves throught different states in the diagram. When you start connecting it's in SYN SENT state, when the initial handshake is over, it's in ESTABLISHED state and so on.</p>
<p>And here's an interesting observation: The API of the socket changes as you move from one state to another. For example, it doesn't make sense to receive data while you are still connecting. But once you are connected, receiving data is all right.</p>
<p>To give a more illustrative example, have a look at <a href="https://tools.ietf.org/html/rfc1929">SOCKS5</a> protocol. It's basically a TCP or UDP proxy protocol. It's used, for example, by Tor. It starts with authentication phase, supporting different kinds of authentication. Then it moves to connection establishment phase. Once again there are different ways to connect. You can connect to an IPv4 address, to a IPv6 address or to a hostname. Finally, the state machine moves to one of the working states. This can be a TCP connection or an UDP connection.</p>
<div class="image-container aligncenter"><img src="http://250bpm.wdfiles.com/local--files/blog:142/mutate2.png" alt="mutate2.png" class="image" /></div>
<p>Note how API changes between the states. In CLOSED state you can call functions such as connect_unauthenticated or connect_password. In AUTHENTICATED state you can call connect_tcp, bind_tcp or open_udp. In TCP ESTABLISHED you can do normal stream socket operations, while in UDP ESTABLISHED you can do datagram operations.</p>
<p>This requirement of mutating API is at odds with how the state machines are normally implemented: There's a single object representing the connection during it's entire lifetime. Therefore, a single object must support different APIs.</p>
<p>What it leads to is code like this:</p>
<div class="code">
<pre>
<code>void Socks5::connect_tcp(Addr addr) {
    if(state != AUTHENTICATED) throw &quot;Cannot connect is this state.&quot;;
    ...
}</code>
</pre></div>
<p>Which, let's be frank, is just an implementation of dynamically typed language on top of statically-typed one.</p>
<p>In other words, by implementing state machines this way we are giving up proper type checking. While compiler would be perfectly able to warn us if connect_tcp was called in CLOSED state, we give up on the possibility and we check the constraint at runtime.</p>
<p>This sounds like bad coding style, but it turns out that the programming languages we use fail to provide tools to handle this kind of scenarios. It's not network programmers who are at fault, but rather programming language designers.</p>
<p>The closest you can get is having a different interface for each state and whenever state transition happens closing the old interface and opening a new one:</p>
<div class="code">
<pre>
<code>auto i1 = socks5_socket();
auto i2 = i1-&gt;connect_unauthenticated(proxy_addr);
// i1 is an invalid pointer at this point
auto i3 = i1-&gt;connect_tcp(addr);
// i2 is an invalid pointer at this point</code>
</pre></div>
<p>But note how ugly the code is. You have there undefined variables (i1, i2) hanging around. If you accidentally try to use them, you'll get a runtime error. And imagine how would the code closing the socket have to look like!</p>
<p>So you try to &quot;undeclare&quot; those variables, but the only way to do &quot;undeclare&quot; is it let the variable fall out of scope:</p>
<div class="code">
<pre>
<code>socks5_tcp_established *i3;
{
    socks5_authenticated *i2;
    {
        auto i1 = socks5_socket();
        i2 = i1-&gt;connect_unauthenticated(proxy_addr);
    }
    i3 = i1-&gt;connect_tcp(addr);
}</code>
</pre></div>
<p>You've got what you wanted &#8212; only i3 is declared when you get to the end of the block &#8212; but you aren't better off. Now you have undefined variables at the beginning. And I am not even speaking of how ugly the code looks like.</p>
<p>Anyway, this rant is addressed to programming language designers: What options do we have to support such mutating API at the moment. And can we do better?</p>
<p><strong>December 24th, 2018</strong></p>
<div class="comments-box">
		
	<div class="options" id="comments-options-hidden" style="display: none">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.showComments(event)">Show Comments</a> 
	</div>
		
	<div id="thread-container" class="thread-container" style="margin-top: 1em">
					


<script type="text/javascript">
	WIKIDOT.forumThreadId = 9693730;
</script>


	<div class="options" id="comments-options-shown">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.hideComments(event)" class="btn btn-default btn-small btn-sm">Hide All Comments</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.unfoldAll(event)" class="btn btn-default btn-small btn-sm">Unfold All</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.foldAll(event)" class="btn btn-default btn-small btn-sm">Fold All</a>
	</div>

<div id="thread-container-posts" style="display: none">
    

<div class="pager"><span class="pager-no">page 1 of 2</span><span class="current">1</span><span class="target"><a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadPostsModule.listeners.updateList(2)">2</a></span><span class="target"><a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadPostsModule.listeners.updateList(2)">next &raquo;</a></span></div>

	
					
      
    <div class="post-container" id="fpc-4097704">
                      
		<div class="post" id="post-4097704">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4097704)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4097704">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=c87d4df27b1b9684cd84d143b069ec83&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>rssh (guest)</span> <span class="odate time_1545640127 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 08:28</span>
														</div>
			</div>
			<div class="content" id="post-content-4097704">
									

<p>session types.<br />
list of languages: <a href="http://groups.inf.ed.ac.uk/abcd/session-implementations.html">http://groups.inf.ed.ac.uk/abcd/session-implementations.html</a><br />
overview: <a href="http://www.di.unito.it/~dezani/papers/sto.pdf">http://www.di.unito.it/~dezani/papers/sto.pdf</a></p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4097704)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4097704)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4097704" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4097704)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4097704)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=c87d4df27b1b9684cd84d143b069ec83&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>rssh (guest)</span>, <span class="odate time_1545640127 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 08:28</span>
		</div>
	</div>
 
                
                	


        
                      
    <div class="post-container" id="fpc-4097753">
                      
		<div class="post" id="post-4097753">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4097753)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4097753">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263597" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1545648984 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 10:56</span>
														</div>
			</div>
			<div class="content" id="post-content-4097753">
									

<p>That looks interesting, but it's hard to find an example to get a feeling how the code would look like. There's even a C implementation &#8212; based on 0mq :) &#8212; but I haven't found any examples. Can you give an example how, say, the socks5 usage would look like?</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4097753)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4097753)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4097753" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4097753)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4097753)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263597" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1545648984 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 10:56</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-4098114">
                      
		<div class="post" id="post-4098114">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4098114)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4098114">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=f11a6143fb27e81c709f0339c7a95211&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Will Sargent (guest)</span> <span class="odate time_1545676921 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 18:42</span>
														</div>
			</div>
			<div class="content" id="post-content-4098114">
									

<p>You can do things with Akka Typed that will go a long way toward Session Types:</p>
<p><a href="https://github.com/rkuhn/akka-typed-session">https://github.com/rkuhn/akka-typed-session</a></p>
<p>Also Rust:</p>
<p><a href="https://github.com/Munksgaard/session-types#example">https://github.com/Munksgaard/session-types#example</a></p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4098114)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4098114)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4098114" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4098114)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4098114)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=f11a6143fb27e81c709f0339c7a95211&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Will Sargent (guest)</span>, <span class="odate time_1545676921 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 18:42</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
                      
    <div class="post-container" id="fpc-4098272">
                      
		<div class="post" id="post-4098272">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4098272)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4098272">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6693f9039e090d1b720fa8f765a38df0&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>exfalso (guest)</span> <span class="odate time_1545687871 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 21:44</span>
														</div>
			</div>
			<div class="content" id="post-content-4098272">
									

<p>Seconded. A more general approach is called linear typing. The point of a linear type is that you can only use a variable with such a type once, and you must use it once. Linear types are usually used to reason about resource usage, but they can be used as a solution for &quot;evolving&quot; types, like the ones you're looking for. Rust uses weaker notions of such types, but for example in GHC Haskell they introduced proper linear types. In both languages it's used for reasoning about resource usage.</p>
<p>As for an example, imagine your second example, only you cannot use i1 again, that would give a compile-time error.</p>
<p>Internally it's actually quite simple to implement linear types, it's simply a matter of how you propagate/merge variable contexts.</p>
<p>Also see <a href="https://gankro.github.io/blah/linear-rust/">https://gankro.github.io/blah/linear-rust/</a></p>
<p>Now having said this, I believe this kind of typing (or in fact any &quot;static&quot; attempt at reducing boilerplate) is *not* useful for state machines, at least not for things like network protocols where the event ordering is outside of the program's control. In fact I would say that the &quot;evolving interface problem&quot; you pose isn't applicable to such state machines.</p>
<p>The core of the issue you're describing is that there's a disconnect between a state machine-like program's dynamic state space and the programmer's conceptual state space. The former seems &quot;too large&quot;, larger than what seems necessary.</p>
<p>This is because when we reason about a stateful program, the efficient reasoning strategy is as you describe, to think of it as transitions from one interface to another, where each interface/state has its own set of events triggering further transitions. Then we can neatly scope our reasoning to particular states, we don't need to think of seemingly impossible scenarios.</p>
<p>However note that when it comes to external events at runtime, *any* event can happen at *any* time, in *any* order, and it doesn't matter what we as programmers think of as a valid event sequence. Any static knowledge we tried to enforce in the state machine through clever typing would mean we're making implicit assumptions about runtime event ordering. This is all the more true for network protocols where we don't just get reordering, we also get duplication and even complete loss.</p>
<p>Another way of putting this would be: the runtime of a program *doesn't care* that a certain state+event combination doesn't fit the programmer's conceptualization of the state space. In theory the combination could happen, so the program should better be prepared for it, even if it's an error condition. From experience I can tell that a lot of these &quot;impossible&quot; states do in fact happen (although usually in extreme conditions), and the verbosity of handling all of them does pay off, as it's very easy to reason about such a condition when it happens if the program is structured as a state machine.</p>
<p>I would also argue that the sheer act of listing all state+event combinations helps to clarify and simplify these protocols in the programmer's head.</p>
<p>So when are session/linear types useful? When the event producer is composed with the event consumer *in the same program*. In these cases the program *can* enforce event ordering and have it align with the desired protocol, ruling out impossible scenarios statically. But network protocols, or in fact any kind of software that handles external events, don't fit this category.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4098272)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4098272)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4098272" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4098272)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4098272)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6693f9039e090d1b720fa8f765a38df0&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>exfalso (guest)</span>, <span class="odate time_1545687871 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 21:44</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-4098490">
                      
		<div class="post" id="post-4098490">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4098490)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4098490">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=c75de9e74a304beb41b705c6bba09db5&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>J Uryga (guest)</span> <span class="odate time_1545708717 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">25 Dec 2018 03:31</span>
														</div>
			</div>
			<div class="content" id="post-content-4098490">
									

<blockquote>
<p>the runtime of a program *doesn't care* that a certain state+event combination doesn't fit the programmer's conceptualization of the state space. In theory the combination could happen, so the program should better be prepared for it, even if it's an error condition</p>
</blockquote>
<p>i don't think there's any conflict between the two. in fact, if you encode the valid state transitions into the type system, the typechecker will *force* you to validate the incoming messages and only &quot;let them in&quot; if they follow your encoded &quot;conceptualization&quot; of the problem. if your code might result in an invalid message getting in, you (hopefully :) get a type error.</p>

							</div>

								
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,4098490)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4098490" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4098490)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4098490)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=c75de9e74a304beb41b705c6bba09db5&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>J Uryga (guest)</span>, <span class="odate time_1545708717 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">25 Dec 2018 03:31</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-4098575">
                      
		<div class="post" id="post-4098575">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4098575)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4098575">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263597" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1545718379 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">25 Dec 2018 06:12</span>
														</div>
			</div>
			<div class="content" id="post-content-4098575">
									

<blockquote>
<p>However note that when it comes to external events at runtime, *any* event can happen at *any* time, in *any* order, and it doesn't matter what we as programmers think of as a valid event sequence.</p>
</blockquote>
<p>That's true, but I think it is possible to treat most of the weird cases as protocol violations and simply close the socket. Think of it as pruning of the state machine. You cut off any weird states and you are left with a state machine that matches programmer's conceptual space and can be modeled by linear types.</p>
<p>Of course, that violates Postel's law, but I am not sure whether in the current security landscape anyone still believes that treating misbehaving peer liberally is a good idea.</p>

							</div>

								
							<div class="changes">
					Last edited on <span class="odate time_1545718426 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">25 Dec 2018 06:13</span>
					by <span class="printuser"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>
					<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showHistory(event,4098575)"><i class="icon-plus"></i> Show more</a>
				</div>
				<div class="revisions" style="display: none"></div>
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,4098575)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4098575" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4098575)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4098575)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263597" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1545718379 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">25 Dec 2018 06:12</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-4099879">
                      
		<div class="post" id="post-4099879">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4099879)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4099879">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6693f9039e090d1b720fa8f765a38df0&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>exfalso (guest)</span> <span class="odate time_1545859465 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">26 Dec 2018 21:24</span>
														</div>
			</div>
			<div class="content" id="post-content-4099879">
									

<p>How would such a program look like?</p>
<p>The academic literature uses process algebras like pi calculus as basis programming languages. These usually have a parallel composition operation that composes two processes, and the typing rule for such a composition is the static check ensuring protocol conformance.</p>
<p>This looks neat on paper, however in practice programs don't look like this. In practice the composition of things like network protocols happens on the process boundary through sockets/file handles. So I cannot *statically* check that two separate peers conform to one another, their interfaces are bytes! This means that there must be a runtime translation layer somewhere that &quot;upgrades&quot; the untyped socket bytestream into a (linearly) typed message sequence, and this layer will need to handle unconforming input all the same. It's only after this &quot;unmarshalling&quot; that the program can use typed sequences.</p>
<p>So then the question is, is it worth splitting the state machine's runtime error handling into a 'protocol check' phase and an 'everything else' phase? Having thought about it, perhaps the answer is yes. Perhaps we can think of this protocol conformance check as simply an extension of usual deserialization. Instead of parsing a bytestring into a typed datastructure we &quot;parse&quot; a bytestream into a typed protocol. And perhaps just like with parser generators/metaprogramming we could automate this boilerplate too!</p>
<p>Ok, having contemplated this further this could be viable. We just need a capable language hehe</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4099879)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4099879)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4099879" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4099879)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4099879)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6693f9039e090d1b720fa8f765a38df0&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>exfalso (guest)</span>, <span class="odate time_1545859465 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">26 Dec 2018 21:24</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4097754">
                      
		<div class="post" id="post-4097754">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4097754)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4097754">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6224ff3a39a4c9efa12e73cc9a194cb5&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Grzegorz (guest)</span> <span class="odate time_1545649164 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 10:59</span>
														</div>
			</div>
			<div class="content" id="post-content-4097754">
									

<p>With c++11 you could use lambdas - it adds some boilerplate syntax, but you get what you want - code won't compile if you make same bug as in your examples (i1 instead of i2 for connect_tcp) i1 is out of scope. Also all variables are always initialized.</p>
<div class="code">
<pre>
<code>auto *i3 = [&amp;]() {
    auto *i2 = [&amp;]() {
        auto i1 = socks5_socket();
        return i1-&gt;connect_unauthenticated(proxy_addr);
    }();
    return i2-&gt;connect_tcp(addr);
}();</code>
</pre></div>
<p>For this certain example you can just chain methods, but builder pattern should allow for same solution for more complicated cases as well:</p>
<div class="code">
<pre>
<code>auto i3 = socks5_socket()
              -&gt;connect_unatuhenticated(proxy_addr)
              -&gt;connect_tcp(addr);</code>
</pre></div>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4097754)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4097754)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4097754" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4097754)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4097754)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6224ff3a39a4c9efa12e73cc9a194cb5&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Grzegorz (guest)</span>, <span class="odate time_1545649164 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 10:59</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4097901">
                      
		<div class="post" id="post-4097901">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4097901)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4097901">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=1945ab4cdb87eaf5a5c906fa884c29f1&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Scott Robinson (guest)</span> <span class="odate time_1545660924 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 14:15</span>
														</div>
			</div>
			<div class="content" id="post-content-4097901">
									

<p><a href="https://en.wikipedia.org/wiki/Substructural_type_system">Linear and affine types</a>. As seen in: Idris, Rust, and Linear Haskell.</p>
<p>The blog post &quot;<a href="https://blog.systems.ethz.ch/blog/2018/a-hammer-you-can-only-hold-by-the-handle.html">A hammer you can only hold by the handle</a>&quot; is relevant to this topic.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4097901)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4097901)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4097901" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4097901)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4097901)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=1945ab4cdb87eaf5a5c906fa884c29f1&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Scott Robinson (guest)</span>, <span class="odate time_1545660924 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 14:15</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-4098051">
                      
		<div class="post" id="post-4098051">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4098051)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4098051">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=0bebedf501885bc11ff7046124911fd0&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Gregory (guest)</span> <span class="odate time_1545670096 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 16:48</span>
														</div>
			</div>
			<div class="content" id="post-content-4098051">
									

<p>Also in Rust, <a href="http://insanitybit.github.io/2016/05/30/beyond-memory-safety-with-types">http://insanitybit.github.io/2016/05/30/beyond-memory-safety-with-types</a></p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4098051)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4098051)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4098051" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4098051)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4098051)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=0bebedf501885bc11ff7046124911fd0&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Gregory (guest)</span>, <span class="odate time_1545670096 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 16:48</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4098205">
                      
		<div class="post" id="post-4098205">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4098205)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4098205">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=56237fe774530d1a3b1c8e761a0d0dd1&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Jonathan Kaye (guest)</span> <span class="odate time_1545683416 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 20:30</span>
														</div>
			</div>
			<div class="content" id="post-content-4098205">
									

<p>You make the correct observation that certain events are not relevant at different moments in the life cycle. It would be more robust to let the specific current state get the first chance to handle an event, and if it doesn't handle it, pass it to a subsuming state. This is the idea of hierarchical state machines (&quot;statecharts&quot;), invented by David Harel in the late 80's. Statecharts are part of the UML and they are several good implementations.</p>
<p>A statechart approach would automatically capture and allow proper error handling for events received not appropriate for the current state, even being able to gracefully handle events that occur in that momentary transition between states (which has some finite time, albeit very small).</p>
<p>Miro Samek (<a href="http://state-machine.com">http://state-machine.com</a>) has a lot of good materials on this.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4098205)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4098205)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4098205" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4098205)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4098205)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=56237fe774530d1a3b1c8e761a0d0dd1&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Jonathan Kaye (guest)</span>, <span class="odate time_1545683416 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 20:30</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4098338">
                      
		<div class="post" id="post-4098338">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4098338)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4098338">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=e17255607bb19ffd5db0bdd8a4dde54c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Rahul (guest)</span> <span class="odate time_1545692153 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 22:55</span>
														</div>
			</div>
			<div class="content" id="post-content-4098338">
									

<p>Maybe I'm missing something obvious here, but wouldn't a Visitor pattern enable relatively clean compile-time type-checking?</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4098338)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4098338)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4098338" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4098338)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4098338)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=e17255607bb19ffd5db0bdd8a4dde54c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Rahul (guest)</span>, <span class="odate time_1545692153 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">24 Dec 2018 22:55</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4098882">
                      
		<div class="post" id="post-4098882">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4098882)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4098882">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=85329cbc7d24dd68265ff4b3a3efc659&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>JasonStedman (guest)</span> <span class="odate time_1545754215 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">25 Dec 2018 16:10</span>
														</div>
			</div>
			<div class="content" id="post-content-4098882">
									

<p>Too many people confuse terseness with cleanliness. Clean code is expressive and easy to reason about. Sometimes verbosity is cleaner than terse syntax. I argue that nested if statements with well named predicate function calls is immensely cleaner than trying to build a type system that handles every possible case as a class or interface.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4098882)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4098882)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4098882" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4098882)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4098882)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=85329cbc7d24dd68265ff4b3a3efc659&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>JasonStedman (guest)</span>, <span class="odate time_1545754215 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">25 Dec 2018 16:10</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4099433">
                      
		<div class="post" id="post-4099433">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4099433)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4099433">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=27e5638bbbdd4095cc304644406da736&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Matt South (guest)</span> <span class="odate time_1545818194 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">26 Dec 2018 09:56</span>
														</div>
			</div>
			<div class="content" id="post-content-4099433">
									

<p>Reginald Braithwaite deals with this by mutating the API of a javascript state engine implementation based on the current state in this series of articles: <a href="http://raganwald.com/2018/03/03/reflections.html">http://raganwald.com/2018/03/03/reflections.html</a></p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4099433)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4099433)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4099433" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4099433)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4099433)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=27e5638bbbdd4095cc304644406da736&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Matt South (guest)</span>, <span class="odate time_1545818194 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">26 Dec 2018 09:56</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4099770">
                      
		<div class="post" id="post-4099770">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4099770)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4099770">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=c12cad3c369049d1a9a8c4a8ff4a2c1c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Anthony Umfer (guest)</span> <span class="odate time_1545850205 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">26 Dec 2018 18:50</span>
														</div>
			</div>
			<div class="content" id="post-content-4099770">
									

<p>I'd probably do it like this</p>
<div class="code">
<pre>
<code>socks5_socket([&amp;](auto closed_socket) {
    closed_socket.connect_unauthenticated(proxy_addr, [&amp;](auto authenticated_socket) {
        authenticated_socket.connect_tcp(addr, [&amp;](auto tcp_socket) {
            //tcp_socket.send or w/e
        });
    });
});</code>
</pre></div>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4099770)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4099770)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4099770" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4099770)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4099770)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=c12cad3c369049d1a9a8c4a8ff4a2c1c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Anthony Umfer (guest)</span>, <span class="odate time_1545850205 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">26 Dec 2018 18:50</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4103396">
                      
		<div class="post" id="post-4103396">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4103396)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4103396">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=b15bde3c4b02a0032cbc95a3d5e5b3ee&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Yannick Moy (guest)</span> <span class="odate time_1546192218 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">30 Dec 2018 17:50</span>
														</div>
			</div>
			<div class="content" id="post-content-4103396">
									

<p>Respect of an automaton in an API is a typical use case for contracts (preconditions and postconditions). See for example the first paragraph in this section of the SPARK formal programming language User's Guide: <a href="http://docs.adacore.com/spark2014-docs/html/ug/en/source/how_to_write_subprogram_contracts.html#writing-contracts-for-functional-correctness">http://docs.adacore.com/spark2014-docs/html/ug/en/source/how_to_write_subprogram_contracts.html#writing-contracts-for-functional-correctness</a></p>
<p>Of course, that means you need a tool that can formally analyze your code, and a programming language that supports such a tool. It's possible in C with Frama-C but more difficult than with a language like SPARK meant for such formal analysis.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4103396)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4103396)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4103396" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4103396)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4103396)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=b15bde3c4b02a0032cbc95a3d5e5b3ee&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Yannick Moy (guest)</span>, <span class="odate time_1546192218 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">30 Dec 2018 17:50</span>
		</div>
	</div>
 
                
        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-4106343">
                      
		<div class="post" id="post-4106343">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,4106343)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-4106343">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=64ca96428fa217085d1282d0fb823fa6&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Dan Massameno (guest)</span> <span class="odate time_1546456601 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">02 Jan 2019 19:16</span>
														</div>
			</div>
			<div class="content" id="post-content-4106343">
									

<p>Have not had a chance to read all the comments, but has anyone seen Sing Sharp?<br />
<a href="https://en.wikipedia.org/wiki/Spec_Sharp#Sing_Sharp">https://en.wikipedia.org/wiki/Spec_Sharp#Sing_Sharp</a><br />
I've read the documents on the Singularity operating system. It looked awesome. Inter-process communication was type-safe, memory-safe, statically checked at compile time and used a finite state machine to control the flow of messages. Sing-Sharp was extended from Spec-Sharp, which was extended from C#.</p>
<p>I would really enjoy hearing from anyone that has read the Singularity research.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,4106343)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,4106343)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-4106343" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,4106343)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,4106343)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=64ca96428fa217085d1282d0fb823fa6&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Dan Massameno (guest)</span>, <span class="odate time_1546456601 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">02 Jan 2019 19:16</span>
		</div>
	</div>
 
                
                	


        
            </div>
 


<div class="pager"><span class="pager-no">page 1 of 2</span><span class="current">1</span><span class="target"><a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadPostsModule.listeners.updateList(2)">2</a></span><span class="target"><a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadPostsModule.listeners.updateList(2)">next &raquo;</a></span></div>
</div>

        <a href="javascript:;" id="new-post-button" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.newPost(event,null)"
      style="display:  none ; margin-bottom:1em"
    >Add a New Comment</a>


    <div id="new-post-form-container">
        <div id="new-post-preview-div" style="display: none">
            <h1>Post preview:</h1>
            <div class="post-container"></div>
            <div></div>
            <a href="javascript:;" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.closePreview(event)" class="btn btn-danger">Close preview</a>
        </div>

        <div id="new-post-div" class="well">
            <form id="new-post-form" onkeypress="return OZONE.utils.disableEnterKey(event)">
                <input type="hidden" name="threadId" value="9693730"/>
                <input type="hidden" name="parentId" value=""/>
                                    <table class="guest-commenting">
                        <tr>
                            <td><input class="text form-control" name="guestName" type="text" maxlength="30" value="" title="Name"/></td>
                            <td>or <a href="#action:login">Sign in as Wikidot user</a></td>
                        </tr>
                        <tr>
                            <td><input class="text form-control" name="guestEmail" type="text" maxlength="50" value="" title="E-mail address"/></td>
                            <td>(will not be published)</td>
                        </tr>
                    </table>
                                <div><textarea id="np-text" name="source" rows="10" cols="50" class="form-control"></textarea></div>
                <div class="change-textarea-size">
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',-5)">-</a>
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',5)">+</a>
                </div>
                <div class="edit-help-34">
                    Help: <a href="http://www.wikidot.com/doc:quick-reference" target="_blank">wiki text quick reference</a>                </div>
                                
                <div id="edit-post-captcha"></div>
                
                <div class="buttons alignleft">
                    <input class="btn btn-danger btn-small btn-sm" type="button" value="Cancel" id="np-cancel" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.cancel(event)"/>
                    <input class="btn btn-default btn-small btn-sm" type="button" value="Preview" id="np-preview" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.preview(event)"/>
                    <input class="btn btn-primary btn-small btn-sm" type="button" value="Post it" id="np-post" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.save(event)"/>
                </div>
                    
            </form>
        </div>	

    </div> 
            <script type="text/javascript">
            
            $j(function() {
                WIKIDOT.Editor.init("np-text", "np-editor-panel");
            });
            
        </script>
    
 

<div style="display:none" id="post-options-template">
	<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showPermalink(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Permanent Link</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.editPost(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Edit</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.deletePost(event,'%POST_ID%')" class="btn btn-danger btn-small btn-sm">Delete</a>
</div>
	
			</div>
	
	
	
</div></div>

                    </div>

                    


                    



                    

                    <div id="page-info-break"></div>
                    
                        <div id="page-options-container">
                            
                        </div>
                    
                    <div id="action-area" style="display: none;"></div>
                </div>
            </div>
            
            
            
            <div id="footer" style="display: block; visibility: visible;">
                <div class="options" style="display: block; visibility: visible;">
    <a href="http://www.wikidot.com/doc" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:terms-of-service" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:privacy-policy" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="http://www.wikidot.com">Wikidot.com</a> 
            </div>
            
                <div id="license-area" class="license-area">
                    Unless otherwise stated, the content of this page is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 License</a>
                </div>
            
            
            



            <div id="extrac-div-1"><span></span></div><div id="extrac-div-2"><span></span></div><div id="extrac-div-3"><span></span></div>
            
            
            
            
                
            
        </div>
        
    </div>
<!-- These extra divs/spans may be used as catch-alls to add extra imagery. -->
<div id="extra-div-1"><span></span></div><div id="extra-div-2"><span></span></div><div id="extra-div-3"><span></span></div>
<div id="extra-div-4"><span></span></div><div id="extra-div-5"><span></span></div><div id="extra-div-6"><span></span></div>
</div>




</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- Quantcast -->
    <script type="text/javascript">
    _qoptions={
        qacct:"p-edL3gsnUjJzw-"
    };
    (function() {
        var qc = document.createElement('script'); qc.type = 'text/javascript'; qc.async = true;
        qc.src = ('https:' == document.location.protocol ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(qc, s);
    })();
    </script>
    <noscript>
        <img src="http://pixel.quantserve.com/pixel/p-edL3gsnUjJzw-.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
    </noscript>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>
</html>