<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">

<head>
    <title>Getting rid of state machines (I) - 250bpm</title>
    
    	<script type="text/javascript" src="http://www.wikidot.com/default__flow/login__CustomDomainScript?site_id=148706"></script>

    
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/init.combined.js"></script>
    <script  type="text/javascript">
        var URL_HOST = 'www.wikidot.com';
        var URL_DOMAIN = 'wikidot.com';
        var USE_SSL =  true ;
        var URL_STATIC = 'http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9';
        // global request information
        
        var WIKIREQUEST = {};
        WIKIREQUEST.info = {};
        
        WIKIREQUEST.info.domain = "250bpm.com";
        WIKIREQUEST.info.siteId = 148706;
        WIKIREQUEST.info.siteUnixName = "250bpm";
        WIKIREQUEST.info.categoryId = 2550760;
        WIKIREQUEST.info.themeId = 18520;
        WIKIREQUEST.info.requestPageName = "blog:69";
        OZONE.request.timestamp = 1594263555;
        OZONE.request.date = new Date();
        WIKIREQUEST.info.lang = 'en';
                WIKIREQUEST.info.pageUnixName = "blog:69";
        WIKIREQUEST.info.pageId = 31768370;
                        WIKIREQUEST.info.lang = "en";
        OZONE.lang = "en";
        var isUAMobile = !!/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    </script>
    
    


    
        <script  type="text/javascript">
    
        require.config({
            baseUrl: URL_STATIC + '/common--javascript',
            paths: {
                'jquery.ui': 'jquery-ui.min',
                'jquery.form': 'jquery.form'
            }
        });
    
    </script>
    
    <meta http-equiv="content-type" content="text/html;charset=UTF-8"/>
            
    
    
    
    
    <meta http-equiv="content-language" content="en"/>
    <script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--javascript/WIKIDOT.combined.js"></script>
        
    
    <style type="text/css" id="internal-style">
        
        /* modules */
        
                
        /* theme */
                    @import url(http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--theme/base/css/style.css);
                    @import url(http://250bpm.wdfiles.com/local--theme/250bpm/style.css);
            </style>
    
        
        
        
    <link rel="shortcut icon" href="/local--favicon/favicon.gif"/>
    <link rel="icon" type="image/gif" href="/local--favicon/favicon.gif"/>
    
            <link rel="apple-touch-icon" href="/common--images/apple-touch-icon-57x57.png" />
        <link rel="apple-touch-icon" sizes="72x72" href="/common--images/apple-touch-icon-72x72.png" />
        <link rel="apple-touch-icon" sizes="114x114" href="/common--images/apple-touch-icon-114x114.png" />
        
        
            <link rel="alternate" type="application/wiki" title="Edit this page" href="javascript:WIKIDOT.page.listeners.editClick()"/>
    
        <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-18234656-1']);
        _gaq.push(['_setDomainName', 'none']);
        _gaq.push(['_setAllowLinker', true]);
        _gaq.push(['_trackPageview']);

        _gaq.push(['old._setAccount', 'UA-68540-5']);
        _gaq.push(['old._setDomainName', 'none']);
        _gaq.push(['old._setAllowLinker', true]);
        _gaq.push(['old._trackPageview']);

                _gaq.push(['userTracker._setAccount', 'UA-3207370-9']);
        _gaq.push(['userTracker._trackPageview']);
            </script>
    
    <script type="text/javascript">
        window.google_analytics_uacct = 'UA-18234656-1';
        window.google_analytics_domain_name = 'none';
    </script>
    
        <link rel="manifest" href="/onesignal/manifest.json" />
    <script src="https://cdn.onesignal.com/sdks/OneSignalSDK.js" acync=""></script>
    <script>
        var OneSignal = window.OneSignal || [];
        OneSignal.push(function() {
          OneSignal.init({
            appId: null,
          });
        });
    </script>
        
<link rel="alternate" type="application/rss+xml" title="Comments for the page &quot;Getting rid of state machines (I)&quot;" href="/feed/page/comments-31768370.xml"/><script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumCommentsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/ForumViewThreadPostsModule.js"></script>
<script type="text/javascript" src="http://d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--modules/js/forum/sub/ForumNewPostFormModule.js"></script>
</head>
<body id="html-body">
<div id="skrollr-body">
<a name="page-top"></a>





<div id="container-wrap-wrap">
    <div id="container-wrap">
        <div id="container">
            <div id="header">
              <h1><a href="/"><span>250bpm</span></a></h1>
                
                
                <!-- google_ad_section_start(weight=ignore) -->
                
                <div id="search-top-box" class="form-search">
    <form id="search-top-box-form" action="dummy" class="input-append">
        <input id="search-top-box-input" class="text empty search-query" type="text" size="15" name="query" value="Search this site" onfocus="if(YAHOO.util.Dom.hasClass(this, 'empty')){YAHOO.util.Dom.removeClass(this,'empty'); this.value='';}"/><input class="button btn" type="submit" name="search" value="Search"/>
    </form>
</div>
                
                
                    <div id="top-bar">
                        

<ul>
<li><a href="/">Home</a></li>
<li><a href="https://github.com/sustrik/cartesian">Cartesian</a></li>
<li><a href="http://libdill.org">Libdill</a></li>
<li><a href="http://nanomsg.org">Nanomsg</a></li>
<li><a href="https://github.com/sustrik/tiles">Tiles</a></li>
<li><a href="http://zero.mq">ZeroMQ</a></li>
<li><a href="/contact">Contact</a></li>
</ul>

                    </div>
                
                <div id="login-status"><a href="javascript:;" onclick="WIKIDOT.page.listeners.createAccount(event)" class="login-status-create-account btn">Create account</a> <span>or</span> <a href="javascript:;" onclick="WIKIDOT.page.listeners.loginClick(event)" class="login-status-sign-in btn btn-primary">Sign in</a> </div>
                <div id="header-extra-div-1"><span></span></div><div id="header-extra-div-2"><span></span></div><div id="header-extra-div-3"><span></span></div>
            </div>
            
            <div id="content-wrap">
                
                    <div id="side-bar">
                        


                        


                        


                    </div>
                
                
                <!-- google_ad_section_end -->
                
                <div id="main-content">
                    <div id="action-area-top"></div>
                    
                    
                        <div id="page-title">
                            Getting rid of state machines (I)
                        </div>
                    

                    

                    



                    <div id="page-content">
                        

<div style="width:50em"><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:68">Enforced Error Handling</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:70">Getting rid of state machines (II)</a></p>
</div>
    
    
    
    </div>
<p>I've written about state machines <a href="http:///www.250bpm.com/blog:25">before</a>.</p>
<p>The message I was trying to convey was that using state machines is superior to relying on callbacks.</p>
<p>Which it is. Most definitely.</p>
<p>However, state machines have a bunch of problems of their own.</p>
<p>In this article I wan to discuss these problems in detail and propose what has to be done to replace state machines by standard linear code.</p>
<h2 id="toc0"><span>What's wrong?</span></h2>
<p>Let's go straight to the problem: State machines are large and brittle.</p>
<p>Typically, there's no built-in support for state machines in your language and so you end up managing a large amount of boilerplate code. (In theory, you could generate the boilerplate, but code generation is super contributor-unfriendly and thus should better be avoided.)</p>
<p>What's worse, the code is complex and hard to reason about. It's extremely easy to get wrong.</p>
<p>In practice, the common traversal paths through the state machines are written and debugged early in the development cycle and what you are left with are bugs in rarely used paths dealing with stuff like timeouts, cancelations or errors. Interactions between different state machines multiply the complexity and what results are rarely seen, non-deterministic heisenbugs that take ages to reproduce and fix.</p>
<h2 id="toc1"><span>What is a state machine?</span></h2>
<p>To fix the problems with state machines we first have to have clear understanding of what state machine is and what it isn't.</p>
<p>To put it simply, state machine is a computation, an algorithm.</p>
<p>It is very similar to 'function' (also known as procedure, method or subroutine), but unlike function it splits the computation is multiple smaller steps. The added value of the splitting is that the state machine can be interrupted each time it processes one step and before it starts processing the next one.</p>
<p>But what's the point? Why would anyone want to execute a function, which is a perfectly sane and nicely encapsulated unit of computation, in several steps?</p>
<p>And here we are getting to the core of the problem: You want to split the function because it may take too long to finish &#8212; it can do a lot of work or maybe just idly wait for I/O &#8212; and in the meantime it blocks other stuff from being executed.</p>
<p>Typical use of state machines is to run a step of one state machine, then run a step from another one and so on. In short, state machine is a very lightweight thread that user can schedule by hand. It is a manual alternative to an OS process or an OS thread.</p>
<h2 id="toc2"><span>Why state machines?</span></h2>
<p>The obvious question thus is: Why state machines? Why not processes or threads?</p>
<p>And the obvious answer is: Performance.</p>
<p>When UNIX was still young, scheduling was supposed to be done by the OS on per-process basis. When implementing a network server, for example, you were supposed to fork a new instance of the process for each TCP connection and rely on the OS scheduler to switch between the processes.</p>
<p>I guess it made sense from performance point of view back then. All the stuff that makes process switching slow today haven't yet existed. Machines had single processor, there was no virtual addressing or memory caches. In such an environment process switching was closer to what we call green threads today.</p>
<p>Later on came threads. Threads are like processes, but operate in the same address space, so there's no need to switch the TLBs. Thus, cost of context switch is lower.</p>
<p>Finally, we've got green threads. These are typically implemented on the language level and avoid even more cost. The latest and most optimised version is Golang's goroutines. They are cooperatively scheduled, thus there is no cost associated with preemption. They have tiny stacks, maybe couple of kilobytes. They can even be scheduled on multiple CPU cores like real OS threads.</p>
<p>Goroutines are performance-wise comparable with hand-written state machines. It seems that there's no more space for radical performance improvement.</p>
<p>So, we can forget about state machines and use green threads instead, right?</p>
<p>Unfortunately no. Green threads, even if they bring us a long way towards the goal, aren't sufficient to eliminate all state machines. In next blog post I'll dig into the remaining problems in more detail.</p>
<p><strong>Martin SÃºstrik, January 5th, 2016</strong></p>
<div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Previous:</strong> <a href="/blog:68">Enforced Error Handling</a></p>
</div>
    
    
    
    </div><div class="list-pages-box">    <div class="list-pages-item">


<p><strong>Next:</strong> <a href="/blog:70">Getting rid of state machines (II)</a></p>
</div>
    
    
    
    </div>
<div style="height:2em"></div>
<div class="comments-box">
		
	<div class="options" id="comments-options-hidden" style="display: none">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.showComments(event)">Show Comments</a> 
	</div>
		
	<div id="thread-container" class="thread-container" style="margin-top: 1em">
					


<script type="text/javascript">
	WIKIDOT.forumThreadId = 1529845;
</script>


	<div class="options" id="comments-options-shown">
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumCommentsModule.listeners.hideComments(event)" class="btn btn-default btn-small btn-sm">Hide All Comments</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.unfoldAll(event)" class="btn btn-default btn-small btn-sm">Unfold All</a> 
		<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.foldAll(event)" class="btn btn-default btn-small btn-sm">Fold All</a>
	</div>

<div id="thread-container-posts" style="display: none">
    



	
					
      
    <div class="post-container" id="fpc-2434873">
                      
		<div class="post" id="post-2434873">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2434873)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2434873">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6566e7b4757033f74d3bd059857c402f&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>lejefedelrodeodeljefe (guest)</span> <span class="odate time_1452013597 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">05 Jan 2016 17:06</span>
														</div>
			</div>
			<div class="content" id="post-content-2434873">
									

<p>Working exactly on this matter at the moment. I am really curious of the next post&#8230;</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2434873)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2434873)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2434873" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2434873)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2434873)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6566e7b4757033f74d3bd059857c402f&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>lejefedelrodeodeljefe (guest)</span>, <span class="odate time_1452013597 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">05 Jan 2016 17:06</span>
		</div>
	</div>
 
                
                	


        
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2435009">
                      
		<div class="post" id="post-2435009">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435009)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435009">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=5e7556658a60c710c9b990d892a5b79b&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Martin (guest)</span> <span class="odate time_1452032041 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">05 Jan 2016 22:14</span>
														</div>
			</div>
			<div class="content" id="post-content-2435009">
									

<p>State machines are also used to implement business processes. And for that use case I don't really see a good alternative. But I'm curious for your next post!</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2435009)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2435009)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435009" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435009)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435009)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=5e7556658a60c710c9b990d892a5b79b&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Martin (guest)</span>, <span class="odate time_1452032041 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">05 Jan 2016 22:14</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2435011">
                      
		<div class="post" id="post-2435011">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435011)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435011">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263555" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1452032480 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">05 Jan 2016 22:21</span>
														</div>
			</div>
			<div class="content" id="post-content-2435011">
									

<p>Good point. Business processes require state of the computation to be persistent, i.e. to survive process restart. And there's (currently) no way to persist the state of green thread. It may be interesting area for research.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2435011)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2435011)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435011" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435011)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435011)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263555" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1452032480 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">05 Jan 2016 22:21</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2435051">
                      
		<div class="post" id="post-2435051">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435051)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435051">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6d198e9d5abc0bb43a8fe0ce36ca4b9c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Alex Elsayed (guest)</span> <span class="odate time_1452042067 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 01:01</span>
														</div>
			</div>
			<div class="content" id="post-content-2435051">
									

<p>Well, there's green threads, there's green threads, and there's green threads.</p>
<p>To be more precise, there's stackful with explicit cooperative rescheduling (possibly also hidden in library calls), stackful with automatically inserted preemption points, and stackless.</p>
<p>The first case is how (say) Duktape coroutines work. An explicit yield construct, etc. With this, one can pickle the state pretty feasibly, as the preemption point will always be at a semantically sensible point in the execution.</p>
<p>The second case is more how goroutines and many other language-level green threads work. These tend to be harder to pickle, less because of the actual green threads and more because this technique sees more use in systems that push their state down into external systems, like the kernel's asynchronous I/O system. That's not something you can serialize or persist.</p>
<p>The third case is where it gets really interesting - that's stuff like the C# async/await construct, which works by inducing the compiler to _transform_ the coroutine into a state machine.</p>
<p>It also has the least overhead of any of the options, due to not needing a stack at all - and if performance is your goal, they take green threads (on Linux, or other OSes with efficient schedulers like the L4 family) from &quot;mostly irrelevant&quot; to &quot;compelling.&quot; At least on Linux, any performance advantages of stackful green threads are essentially in the noise, and that's without considering that 'large stacks' aren't a feature of OS threads, but rather glibc. Musl allows considerably smaller per-thread stacks.</p>
<p>But honestly, I think that saying that the need for persistence is why business processes use state machines fundamentally misses the real reason:</p>
<p>By and large, business processes are _specified_ as state machines - the flowcharts and process diagrams behind it all. And in the end, one of the best things one can do for maintainability is to keep a strong correspondence between the spec and the code.</p>

							</div>

								
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,2435051)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435051" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435051)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435051)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6d198e9d5abc0bb43a8fe0ce36ca4b9c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Alex Elsayed (guest)</span>, <span class="odate time_1452042067 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 01:01</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-2435410">
                      
		<div class="post" id="post-2435410">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435410)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435410">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263555" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1452100267 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 17:11</span>
														</div>
			</div>
			<div class="content" id="post-content-2435410">
									

<p>I don't really care whether my language translates my function into something with its own stack or whether it's clever enough to generate a state machine from it.</p>
<p>All I want is to write a simple imperative code that's an order of magnitude easier to understand and manage than an equivalent state machine.</p>
<p>And, arguably, green threads of one sort or another bring us closer to this goal.</p>
<p>As for the business processes, it's kind of chicken and egg problem. There's no way to build them using simple linear code (because persistence) so everybody goes with state machines both for implementation and specification. If it was the other way round, everyone would just go with imperative programming, I guess.</p>

							</div>

								
							<div class="changes">
					Last edited on <span class="odate time_1452100307 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 17:11</span>
					by <span class="printuser"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>
					<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showHistory(event,2435410)"><i class="icon-plus"></i> Show more</a>
				</div>
				<div class="revisions" style="display: none"></div>
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2435410)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2435410)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435410" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435410)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435410)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263555" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1452100267 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 17:11</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2435066">
                      
		<div class="post" id="post-2435066">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435066)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435066">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=fe8e4742bbc96687699d22ead39cb05c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Apostolis (guest)</span> <span class="odate time_1452045774 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 02:02</span>
														</div>
			</div>
			<div class="content" id="post-content-2435066">
									

<p>I am currently studying the idris (<a href="http://idris-lang.org">http://idris-lang.org</a>) language which is an eager evaluated dependent-type functional programming language.</p>
<p>In it one can specify each state as a different type and a &quot;function&quot; (of Types) that transform one type/state to another type/state.</p>
<p>The result is that any deviation from the state machine specification is a compile time error.</p>
<p>Edwin Brady expains this in his talk : <a href="https://youtu.be/kpPyolN65s0?t=14m17s">https://youtu.be/kpPyolN65s0?t=14m17s</a></p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2435066)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2435066)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435066" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435066)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435066)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=fe8e4742bbc96687699d22ead39cb05c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Apostolis (guest)</span>, <span class="odate time_1452045774 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 02:02</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2435127">
                      
		<div class="post" id="post-2435127">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435127)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435127">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6d198e9d5abc0bb43a8fe0ce36ca4b9c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Alex Elsayed (guest)</span> <span class="odate time_1452053022 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 04:03</span>
														</div>
			</div>
			<div class="content" id="post-content-2435127">
									

<p>One can do the same thing with Rust, tidily enough:</p>
<div class="code">
<pre>
<code>struct AwaitingRequest(Socket);
struct GotRequest(Socket, String);

impl AwaitingRequest {
    fn listen(port: u16) -&gt; Result&lt;AwaitingRequest, ()&gt; {
        match PSEUDOCODE_SOCKET_OPEN(port) {
            Ok(x) =&gt; Ok(AwaitingRequest(x)),
            Err(_) =&gt; Err(()),
    }
    }
    fn recv(self, timeout: u32) -&gt; Result&lt;GotRequest, AwaitingRequest&gt; {
        match PSEUDOCODE_SOCKET_RECV(self.0, timeout) {
            Ok(x) =&gt; Ok(GotRequest(self.0, x)),
            Err(_) =&gt; Err(self),
        }
    }
}

impl GotRequest {
    fn request(&amp;self) -&gt; String {
       self.1.clone()
    }
    fn reply(self, timeout: u32, message: String) -&gt; Result&lt;AwaitingRequest, GotRequest&gt; {
        match PSEUDOCODE_SOCKET_SEND(self.0, timeout, message) {
            Ok(_) =&gt; Ok(AwaitingRequest(self.0)),
            Err(_) =&gt; Err(self),
        }
    }
    fn close(self) {
        self.0.shutdown()
    }
}</code>
</pre></div>
<p>With that, a sequence like this compiles:</p>
<p>AwaitingRequest::listen(80).recv().expect(&quot;Timed out receiving&quot;).reply(&quot;Read you loud and clear&quot;).expect(&quot;Timed out sending).close();</p>
<p>But this would fail:</p>
<p>AwaitingRequest::listen(80).reply(&quot;Me first!&quot;);</p>
<p>As would this:</p>
<p>AwaitingRequest::listen(80).request();</p>
<p>In addition, each of those types takes up no more space than their members, and the methods are statically dispatched with no overhead.</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2435127)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2435127)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435127" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435127)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435127)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6d198e9d5abc0bb43a8fe0ce36ca4b9c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Alex Elsayed (guest)</span>, <span class="odate time_1452053022 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 04:03</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2435129">
                      
		<div class="post" id="post-2435129">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435129)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435129">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6d198e9d5abc0bb43a8fe0ce36ca4b9c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Alex Elsayed (guest)</span> <span class="odate time_1452053182 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 04:06</span>
														</div>
			</div>
			<div class="content" id="post-content-2435129">
									

<p>Oh, also, those states would be allocated on the stack (he String type in Rust is heap-allocated, but state machines that never touch the heap are really trivial to implement)</p>

							</div>

								
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,2435129)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435129" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435129)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435129)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6d198e9d5abc0bb43a8fe0ce36ca4b9c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Alex Elsayed (guest)</span>, <span class="odate time_1452053182 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 04:06</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-2435140">
                      
		<div class="post" id="post-2435140">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435140)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435140">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=fe8e4742bbc96687699d22ead39cb05c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Apostolis (guest)</span> <span class="odate time_1452056408 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 05:00</span>
														</div>
			</div>
			<div class="content" id="post-content-2435140">
									

<p>Yes, Rust is orders of magnitude better than C.</p>
<p>I would prefer though if there was a separation between the state machine specification and the implementation.</p>
<p>I think that ,with with the use of traits, that can be achieved.</p>
<p>Rust is cool.</p>

							</div>

								
					
						<div class="options">
				
																					<a href="javascript:;" onclick="togglePostOptions(event,2435140)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435140" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435140)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435140)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=fe8e4742bbc96687699d22ead39cb05c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Apostolis (guest)</span>, <span class="odate time_1452056408 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 05:00</span>
		</div>
	</div>
 
                
        
            </div>
 
                      
    <div class="post-container" id="fpc-2435156">
                      
		<div class="post" id="post-2435156">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435156)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435156">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6d198e9d5abc0bb43a8fe0ce36ca4b9c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Alex Elsayed (guest)</span> <span class="odate time_1452058935 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 05:42</span>
														</div>
			</div>
			<div class="content" id="post-content-2435156">
									

<p>Yup - if I wanted to be more abstract, I could have done something like this:</p>
<div class="code">
<pre>
<code>// A state takes input and then outputs the result of some transition
trait State {
    type Input;
    type Output;
    fn transition(self, Input) -&gt; Output;
}

// The first state
struct Alpha;
// It accepts either success or failure
enum AlphaInputs {
    Success,
    Failure,
};
// On success, it proceeds to beta. On failure, it remains at Alpha.
type AlphaTransitions = Result&lt;Beta, Alpha&gt;;

// The second state
struct Beta;
// It accepts either returning to the beginning, or terminating the machine
enum BetaInputs {
    Again,
    Finished,
};
// On Again, it returns to state Alpha. On Finished, the state machine is destroyed.
type BetaTransitions = Option&lt;Alpha&gt;;

impl State for A {
    type Input = AlphaInputs;
    type Output = AlphaTransitions;
    fn transition(self, input: Self::Input) -&gt; Self::Output {
        match input {
            Success =&gt; Ok(Beta),
            Failure =&gt; Err(Alpha),
        }
    }
}

impl State for Beta {
    type Input = BetaInputs;
    type Output = BetaTransitions;
    fn transition(self, input: Self::Input) -&gt; Self::Output {
        match input {
            Again =&gt; Some(Alpha),
            Finished =&gt; None,
        }
    }
}</code>
</pre></div>
<p>This would allow</p>
<div class="code">
<pre>
<code>Alpha.transition(Success).unwrap()
    .transition(Again).unwrap()
    .transition(Failure).unwrap_err()
    .transition(Success).unwrap()
    .transition(Done);</code>
</pre></div>
<p>(Note that the &quot;unwrap&quot;s are not idiomatic; in real code where the transition may vary at runtime, you'd use match { } to extract the values)</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2435156)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2435156)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435156" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435156)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435156)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=6d198e9d5abc0bb43a8fe0ce36ca4b9c&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Alex Elsayed (guest)</span>, <span class="odate time_1452058935 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">06 Jan 2016 05:42</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 
            </div>
 

	
					
      
    <div class="post-container" id="fpc-2435863">
                      
		<div class="post" id="post-2435863">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435863)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435863">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=a32ab6b6d7edf5f36874ca7d6fc243b4&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Zealord (guest)</span> <span class="odate time_1452180677 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">07 Jan 2016 15:31</span>
														</div>
			</div>
			<div class="content" id="post-content-2435863">
									

<p>What would you think of a program communicating with other devices using Bluetooth, for example? I can see a clearly cut state machine for that: Connecting -&gt; [Connection Succeeded] -&gt; Reading -&gt; [Value received] -&gt; Disconnecting</p>
<p>What would an argument against it be?</p>
<p>Great post by the way, I loved reading it as I've ran into similar problems! Found it as one of the first hits when Googling :)</p>

							</div>

								
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2435863)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2435863)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435863" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435863)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435863)"></a> by <span class="printuser avatarhover"><a href="javascript:;"><img class="small" src="http://www.gravatar.com/avatar.php?gravatar_id=a32ab6b6d7edf5f36874ca7d6fc243b4&amp;default=http://www.wikidot.com/common--images/avatars/default/a16.png&amp;size=16" alt=""/></a>Zealord (guest)</span>, <span class="odate time_1452180677 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">07 Jan 2016 15:31</span>
		</div>
	</div>
 
                
        
                      
    <div class="post-container" id="fpc-2435892">
                      
		<div class="post" id="post-2435892">
		<div class="long">
			<div class="head">
									<div class="options">
						<a href="javascript:;" onclick="togglePostFold(event,2435892)" class="btn btn-default btn-small btn-sm">Fold</a>
					</div>
								<div class="title" id="post-title-2435892">
																		
															</div>
				<div class="info">
					<span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263555" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span> <span class="odate time_1452185127 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">07 Jan 2016 16:45</span>
														</div>
			</div>
			<div class="content" id="post-content-2435892">
									

<p>Try adding timeout to the state machine (e.g. the value wasn't received in 1 min). Then try adding cancelation (e.g. user canceled the process while waiting for connection to succeed, user canceled the process while waiting for the value, user canceled the process while disconnection was happening). Very soon your nice state machine will turn into an ugly mess.</p>

							</div>

								
							<div class="changes">
					Last edited on <span class="odate time_1452185147 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">07 Jan 2016 16:45</span>
					by <span class="printuser"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>
					<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showHistory(event,2435892)"><i class="icon-plus"></i> Show more</a>
				</div>
				<div class="revisions" style="display: none"></div>
					
						<div class="options">
				
													<strong><a href="javascript:;" onclick="postReply(event,2435892)" class="btn btn-primary btn-small btn-sm">Reply</a></strong> 
																	<a href="javascript:;" onclick="togglePostOptions(event,2435892)" class="btn btn-default btn-small btn-sm">Options</a>
							</div>
									
			<div id="post-options-2435892" class="options" style="display: none">
			</div>
		</div>
		<div class="short">
							<a class="options btn btn-default btn-mini btn-xs" href="javascript:;" onclick="togglePostFold(event,2435892)" c>Unfold</a>
						<a class="title" href="javascript:;" onclick="togglePostFold(event,2435892)"></a> by <span class="printuser avatarhover"><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;"  ><img class="small" src="http://www.wikidot.com/avatar.php?userid=939&amp;amp;size=small&amp;amp;timestamp=1594263555" alt="martin_sustrik" style="background-image:url(http://www.wikidot.com/userkarma.php?u=939)"/></a><a href="http://www.wikidot.com/user:info/martin-sustrik" onclick="WIKIDOT.page.listeners.userInfo(939); return false;" >martin_sustrik</a></span>, <span class="odate time_1452185127 format_%25e%20%25b%20%25Y%2C%20%25H%3A%25M%7Cagohover">07 Jan 2016 16:45</span>
		</div>
	</div>
 
                
        
            </div>
 
            </div>
 



</div>

        <a href="javascript:;" id="new-post-button" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.newPost(event,null)"
      style="display:  none ; margin-bottom:1em"
    >Add a New Comment</a>


    <div id="new-post-form-container">
        <div id="new-post-preview-div" style="display: none">
            <h1>Post preview:</h1>
            <div class="post-container"></div>
            <div></div>
            <a href="javascript:;" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.closePreview(event)" class="btn btn-danger">Close preview</a>
        </div>

        <div id="new-post-div" class="well">
            <form id="new-post-form" onkeypress="return OZONE.utils.disableEnterKey(event)">
                <input type="hidden" name="threadId" value="1529845"/>
                <input type="hidden" name="parentId" value=""/>
                                    <table class="guest-commenting">
                        <tr>
                            <td><input class="text form-control" name="guestName" type="text" maxlength="30" value="" title="Name"/></td>
                            <td>or <a href="#action:login">Sign in as Wikidot user</a></td>
                        </tr>
                        <tr>
                            <td><input class="text form-control" name="guestEmail" type="text" maxlength="50" value="" title="E-mail address"/></td>
                            <td>(will not be published)</td>
                        </tr>
                    </table>
                                <div><textarea id="np-text" name="source" rows="10" cols="50" class="form-control"></textarea></div>
                <div class="change-textarea-size">
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',-5)">-</a>
                    <a href="javascript:;" onclick="WIKIDOT.utils.changeTextareaRowNo('np-text',5)">+</a>
                </div>
                <div class="edit-help-34">
                    Help: <a href="http://www.wikidot.com/doc:quick-reference" target="_blank">wiki text quick reference</a>                </div>
                                
                <div id="edit-post-captcha"></div>
                
                <div class="buttons alignleft">
                    <input class="btn btn-danger btn-small btn-sm" type="button" value="Cancel" id="np-cancel" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.cancel(event)"/>
                    <input class="btn btn-default btn-small btn-sm" type="button" value="Preview" id="np-preview" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.preview(event)"/>
                    <input class="btn btn-primary btn-small btn-sm" type="button" value="Post it" id="np-post" onclick="WIKIDOT.modules.ForumNewPostFormModule.listeners.save(event)"/>
                </div>
                    
            </form>
        </div>	

    </div> 
            <script type="text/javascript">
            
            $j(function() {
                WIKIDOT.Editor.init("np-text", "np-editor-panel");
            });
            
        </script>
    
 

<div style="display:none" id="post-options-template">
	<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.showPermalink(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Permanent Link</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.editPost(event,'%POST_ID%')" class="btn btn-default btn-small btn-sm">Edit</a>
			<a href="javascript:;" onclick="WIKIDOT.modules.ForumViewThreadModule.listeners.deletePost(event,'%POST_ID%')" class="btn btn-danger btn-small btn-sm">Delete</a>
</div>
	
			</div>
	
	
	
</div></div>

                    </div>

                    


                    



                    

                    <div id="page-info-break"></div>
                    
                        <div id="page-options-container">
                            
                        </div>
                    
                    <div id="action-area" style="display: none;"></div>
                </div>
            </div>
            
            
            
            <div id="footer" style="display: block; visibility: visible;">
                <div class="options" style="display: block; visibility: visible;">
    <a href="http://www.wikidot.com/doc" id="wikidot-help-button">Help</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:terms-of-service" id="wikidot-tos-button">Terms of Service</a>
    &nbsp;|
    <a href="http://www.wikidot.com/legal:privacy-policy" id="wikidot-privacy-button">Privacy</a>
    &nbsp;|
    <a href="javascript:;" id="bug-report-button" onclick="WIKIDOT.page.listeners.pageBugReport(event)">Report a bug</a>
    &nbsp;|
    <a href="javascript:;" id="abuse-report-button" onclick="WIKIDOT.page.listeners.flagPageObjectionable(event)">Flag as objectionable</a>
</div>
Powered by <a href="http://www.wikidot.com">Wikidot.com</a> 
            </div>
            
                <div id="license-area" class="license-area">
                    Unless otherwise stated, the content of this page is licensed under <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 License</a>
                </div>
            
            
            



            <div id="extrac-div-1"><span></span></div><div id="extrac-div-2"><span></span></div><div id="extrac-div-3"><span></span></div>
            
            
            
            
                
            
        </div>
        
    </div>
<!-- These extra divs/spans may be used as catch-alls to add extra imagery. -->
<div id="extra-div-1"><span></span></div><div id="extra-div-2"><span></span></div><div id="extra-div-3"><span></span></div>
<div id="extra-div-4"><span></span></div><div id="extra-div-5"><span></span></div><div id="extra-div-6"><span></span></div>
</div>




</div>
<div id="dummy-ondomready-block" style="display: none;" ></div>
    <!-- Google Analytics load -->
    <script type="text/javascript">
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <!-- Quantcast -->
    <script type="text/javascript">
    _qoptions={
        qacct:"p-edL3gsnUjJzw-"
    };
    (function() {
        var qc = document.createElement('script'); qc.type = 'text/javascript'; qc.async = true;
        qc.src = ('https:' == document.location.protocol ? 'https://secure' : 'http://edge') + '.quantserve.com/quant.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(qc, s);
    })();
    </script>
    <noscript>
        <img src="http://pixel.quantserve.com/pixel/p-edL3gsnUjJzw-.gif" style="display: none;" border="0" height="1" width="1" alt="Quantcast"/>
    </noscript>




<div id="page-options-bottom-tips" style="display: none;">
    <div id="edit-button-hovertip">
        Click here to edit contents of this page.    </div>
</div>
<div id="page-options-bottom-2-tips"  style="display: none;">
    <div id="edit-sections-button-hovertip">
        Click here to toggle editing of individual sections of the page (if possible).         Watch headings for an &quot;edit&quot; link when available.    </div>
    <div id="edit-append-button-hovertip">
        Append content without editing the whole page source.    </div>
    <div id="history-button-hovertip">
        Check out how this page has evolved in the past.    </div>
    <div id="discuss-button-hovertip">
        If you want to discuss contents of this page - this is the easiest way to do it.    </div>
    <div id="files-button-hovertip">
        View and manage file attachments for this page.    </div>
    <div id="site-tools-button-hovertip">
        A few useful tools to manage this Site.    </div>
    <div id="backlinks-button-hovertip">
        See pages that link to and include this page.    </div>
    <div id="rename-move-button-hovertip">
        Change the name (also URL address, possibly the category) of the page.    </div>
    <div id="view-source-button-hovertip">
        View wiki source for this page without editing.    </div>
    <div id="parent-page-button-hovertip">  
        View/set parent page (used for creating breadcrumbs and structured layout).    </div>
            <div id="abuse-report-button-hovertip">
            Notify administrators if there is objectionable content in this page.        </div>
        <div id="bug-report-button-hovertip">
            Something does not work as expected? Find out what you can do.        </div>
        <div id="wikidot-help-button-hovertip">
            General Wikidot.com documentation and help section.        </div>
        <div id="wikidot-tos-button-hovertip">
            Wikidot.com Terms of Service - what you can, what you should not etc.        </div>
        <div id="wikidot-privacy-button-hovertip">
            Wikidot.com Privacy Policy.          
        </div>
    </div>
</body>
</html>